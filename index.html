<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>阿盧的程式筆記</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="阿盧的程式筆記">
<meta property="og:url" content="http://aloo31124.github.io/index.html">
<meta property="og:site_name" content="阿盧的程式筆記">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="盧本翔">
<meta property="article:tag" content="程式">
<meta property="article:tag" content=" java">
<meta property="article:tag" content=" php">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="阿盧的程式筆記" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">阿盧的程式筆記</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">程式學海無涯~回頭是岸阿~~ QAQ</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜尋"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://aloo31124.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-laravel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/25/laravel/" class="article-date">
  <time datetime="2020-08-25T11:17:00.000Z" itemprop="datePublished">2020-08-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/25/laravel/">[laravel][作品集12] 右側內容頁面1-新增作品</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4>產生新增視窗與刪除</h4>
<h5>顯示新增作品的 對話框 Modal</h5>

<p>按下[新增作品]按鈕</p>
<p><img src="/images/pasted-48.png" alt=""></p>
<p>隨後會跳出新增作品的對話框 Modal</p>
<p><img src="/images/pasted-49.png" alt=""></p>
<p>按下 [新增作品] 按鈕 ，一樣先呼叫 buildAddPortfolioModalInfo() 函式，從 $(‘#RightContentTitle’).text() 右內容頁事先取得目錄名稱。<br>隨後用 data-target=”#addPortfolioModal” 導向 Modal ，產生如上圖的 Modal的對話視窗。</p>
<p>public\js\portfolioIndex\addPortfolio.js</p>
<pre>
  function buildAddPortfolioModalInfo(){
    $(&#x27;&#x23;addPortfolioForCategory&#x27;).text( $(&#x27;&#x23;RightContentTitle&#x27;).text() );
  }
</pre>

<p>隨後用 data-target=”#addPortfolioModal” 導向 Modal ，產生如上圖的 Modal的對話視窗。</p>
<p>resources\views\portfolioIndex.blade.php</p>
<pre>
&#x3C;div class=&#x22;col-8&#x22;&#x3E;  
    &#x3C;h2&#x3E;作品分類:&#x3C;span id=&#x27;RightContentTitle&#x27;&#x3E;&#x3C;&#x2F;span&#x3E;&#x3C;&#x2F;h2&#x3E;    
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; data-toggle=&#x22;modal&#x22; onclick=&#x22;buildAddPortfolioModalInfo()&#x22; data-target=&#x22;&#x23;addPortfolioModal&#x22; &#x3E;新增作品&#x3C;&#x2F;button&#x3E;    
......

    &#x3C;!--新增作品 Modal start--&#x3E;
    &#x3C;div class=&#x22;modal fade &#x22; id=&#x22;addPortfolioModal&#x22; tabindex=&#x22;-1&#x22; role=&#x22;dialog&#x22; aria-labelledby=&#x22;editModalLabel&#x22; aria-hidden=&#x22;true&#x22; data-backdrop=&#x22;static&#x22;&#x3E;
      &#x3C;div class=&#x22;modal-dialog  modal-lg&#x22; role=&#x22;document&#x22;&#x3E;          
          &#x3C;div class=&#x22;modal-content&#x22;&#x3E;
            &#x3C;div class=&#x22;modal-header&#x22;&#x3E;
              &#x3C;h5 class=&#x22;modal-title&#x22; id=&#x22;editModalLabel&#x22;&#x3E;新增作品&#x3C;&#x2F;h5&#x3E;
            &#x3C;&#x2F;div&#x3E;            
            &#x3C;div class=&#x22;modal-body&#x22;&#x3E;        
              作品分類:&#x3C;span id=&#x27;addPortfolioForCategory&#x27;&#x3E;&#x3C;&#x2F;span&#x3E;              
              &#x3C;div class=&#x22;form-group&#x22;&#x3E;
                &#x3C;label class=&#x22;col-form-label&#x22;&#x3E;作品名稱:&#x3C;&#x2F;label&#x3E;
                &#x3C;input type=&#x22;text&#x22; class=&#x22;form-control&#x22;  value=&#x22;&#x22; id=&#x22;insertPortfolioName&#x22; name=&#x22;insertPortfolioName&#x22;&#x3E;              
                &#x3C;label class=&#x22;col-form-label&#x22;&#x3E;作品說明:&#x3C;&#x2F;label&#x3E;
                &#x3C;input type=&#x22;text&#x22; class=&#x22;form-control&#x22;  value=&#x22;&#x22; id=&#x22;insertPortfolioDiscription&#x22;  name=&#x22;insertPortfolioDiscription&#x22;&#x3E;                      
              &#x3C;&#x2F;div&#x3E;
            &#x3C;&#x2F;div&#x3E;
            &#x3C;div class=&#x22;modal-footer&#x22;&#x3E;
              &#x3C;button type=&#x22;button&#x22; class=&#x22;btn btn-secondary&#x22; data-dismiss=&#x22;modal&#x22; onclick=&#x22;cleanAddPortfolioModal()&#x22; &#x3E;取消&#x3C;&#x2F;button&#x3E;
              &#x3C;button type=&#x22;button&#x22; class=&#x22;btn btn-info&#x22; data-dismiss=&#x22;modal&#x22; onclick=&#x22;addPortfolioAndReloadRightContentCard()&#x22; &#x3E;儲存&#x3C;&#x2F;button&#x3E;                                       
            &#x3C;&#x2F;div&#x3E;
          &#x3C;&#x2F;div&#x3E;        
      &#x3C;&#x2F;div&#x3E;
    &#x3C;&#x2F;div&#x3E;
    &#x3C;!--新增作品 Modal end--&#x3E;
</pre>


<h5>按下取消將原本 Modal 內容刪除</h5>
Modal 的設計類似該網頁的延伸，當將該視窗直接關閉的時候，輸入框 input type="text" 會仍然保有之前輸入的文字。
因此按下取消按鈕時，會執行 cleanAddPortfolioModal() 方法，將兩輸入框 "作品名稱"、"作品說明" 清空，如下程式:

<p>public\js\portfolioIndex\addPortfolio.js</p>
<pre>
  function cleanAddPortfolioModal(){
    $(&#x22;&#x23;insertPortfolioName&#x22;).val(&#x22;&#x22;);
    $(&#x22;&#x23;insertPortfolioDiscription&#x22;).val(&#x22;&#x22;);
  }
</pre>


<hr>

<h4>存入資料庫並刷新</h4>

<h5>按下[儲存]導向 controller</h5>
使用 ajax() 分別將 "作品名稱 (insertPortfolioName)"、"作品說明(insertPortfolioDiscription)" 與該作品所屬分類 id 從 request 經由路由傳給 controller 程式處理。

<p>public\js\portfolioIndex\addPortfolio.js</p>
<pre>
  function addPortfolioAndReloadRightContentCard(){
    var insertPortfolioName = $(&#x22;&#x23;insertPortfolioName&#x22;).val();
    var insertPortfolioDiscription = $(&#x22;&#x23;insertPortfolioDiscription&#x22;).val();
    var currentCategoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioAdd&#x27;,
      data: {
        insertPortfolioName : insertPortfolioName,
        insertPortfolioDiscription : insertPortfolioDiscription,
        currentCategoryId : currentCategoryId,
        &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
      } ,&#x2F;&#x2F;419
      success:function(result){
        $(&#x22;&#x23;RightContent&#x22;).html(result);
      },
      error:function(){
        console.log(&#x22;addPortfolioAndReloadRightContentCard() error&#x22;);
      }
    });
    cleanAddPortfolioModal();
  }
</pre>

<p>routes\web.php</p>
<pre>
Route::get('/portfolioAdd','portfolioController@insertPortfolioInDBAndReload');
</pre>

<p>導向到 portfolioController.php 程式的 insertPortfolioInDBAndReload() 函式中，並新增一個作品資料存入資料庫。<br>呼叫 buildRightContent() 函式，重建右內容頁已完成重新刷新。</p>
<p>app\Http\Controllers\portfolioController.php</p>
<pre>
    public function insertPortfolioInDBAndReload(Request $reqeust){
        $db = new portfolio();
        $db-&#x3E;name = $reqeust-&#x3E;insertPortfolioName;        
        $db-&#x3E;discription = $reqeust-&#x3E;insertPortfolioDiscription;        
        $db-&#x3E;portfolio_category_id = $reqeust-&#x3E;currentCategoryId;        
        $db-&#x3E;sort = 0;                
        $db-&#x3E;save();                
        return $this-&#x3E;buildRightContent($reqeust);
    }

    function buildRightContent(Request $request){
        $db = new portfolio();
        $portfolioInfoFromDB = $db -&#x3E; findportfolioInfoByCategoryId($request-&#x3E;currentCategoryId);
        $RightContentHtml = &#x22;&#x22;;
            ......
        return $RightContentHtml;
    }
</pre>

<h5>重新刷新右內容頁，顯示新增作品</h5>
buildRightContent() 函式串好右內容頁後，return 回傳給 ajax()，並顯示。
備註: ajax() 的運作機制，若是預設(非同步) 會執行 addPortfolioAndReloadRightContentCard()函式外層的程式後，才會執行 ajax()。
也就是說會先執行完 cleanAddPortfolioModal() 函式，才會執行 ajax() ，不過不會影響本次功能。

<p>public\js\portfolioIndex\addPortfolio.js</p>
<pre>
  function addPortfolioAndReloadRightContentCard(){
               ......
    $.ajax({
            ......
      } ,
      success:function(result){
        $(&#x22;&#x23;RightContent&#x22;).html(result);
      },
      error:function(){
        console.log(&#x22;addPortfolioAndReloadRightContentCard() error&#x22;);
      }
    });
    cleanAddPortfolioModal();
  }
</pre>


<hr>
<h4>執行結果:</h4>

<img src='https://i.imgur.com/CunKURE.gif' />

<hr>
<h4>完整程式:</h4>

<p>resources\views\portfolioIndex.blade.php</p>
<pre>
&#x3C;div class=&#x22;col-8&#x22;&#x3E;  
    &#x3C;h2&#x3E;作品分類:&#x3C;span id=&#x27;RightContentTitle&#x27;&#x3E;&#x3C;&#x2F;span&#x3E;&#x3C;&#x2F;h2&#x3E;    
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; data-toggle=&#x22;modal&#x22; onclick=&#x22;buildAddPortfolioModalInfo()&#x22; data-target=&#x22;&#x23;addPortfolioModal&#x22; &#x3E;新增作品&#x3C;&#x2F;button&#x3E;    
......

    &#x3C;!--新增作品 Modal start--&#x3E;
    &#x3C;div class=&#x22;modal fade &#x22; id=&#x22;addPortfolioModal&#x22; tabindex=&#x22;-1&#x22; role=&#x22;dialog&#x22; aria-labelledby=&#x22;editModalLabel&#x22; aria-hidden=&#x22;true&#x22; data-backdrop=&#x22;static&#x22;&#x3E;
      &#x3C;div class=&#x22;modal-dialog  modal-lg&#x22; role=&#x22;document&#x22;&#x3E;          
          &#x3C;div class=&#x22;modal-content&#x22;&#x3E;
            &#x3C;div class=&#x22;modal-header&#x22;&#x3E;
              &#x3C;h5 class=&#x22;modal-title&#x22; id=&#x22;editModalLabel&#x22;&#x3E;新增作品&#x3C;&#x2F;h5&#x3E;
            &#x3C;&#x2F;div&#x3E;            
            &#x3C;div class=&#x22;modal-body&#x22;&#x3E;        
              作品分類:&#x3C;span id=&#x27;addPortfolioForCategory&#x27;&#x3E;&#x3C;&#x2F;span&#x3E;              
              &#x3C;div class=&#x22;form-group&#x22;&#x3E;
                &#x3C;label class=&#x22;col-form-label&#x22;&#x3E;作品名稱:&#x3C;&#x2F;label&#x3E;
                &#x3C;input type=&#x22;text&#x22; class=&#x22;form-control&#x22;  value=&#x22;&#x22; id=&#x22;insertPortfolioName&#x22; name=&#x22;insertPortfolioName&#x22;&#x3E;              
                &#x3C;label class=&#x22;col-form-label&#x22;&#x3E;作品說明:&#x3C;&#x2F;label&#x3E;
                &#x3C;input type=&#x22;text&#x22; class=&#x22;form-control&#x22;  value=&#x22;&#x22; id=&#x22;insertPortfolioDiscription&#x22;  name=&#x22;insertPortfolioDiscription&#x22;&#x3E;                      
              &#x3C;&#x2F;div&#x3E;
            &#x3C;&#x2F;div&#x3E;
            &#x3C;div class=&#x22;modal-footer&#x22;&#x3E;
              &#x3C;button type=&#x22;button&#x22; class=&#x22;btn btn-secondary&#x22; data-dismiss=&#x22;modal&#x22; onclick=&#x22;cleanAddPortfolioModal()&#x22; &#x3E;取消&#x3C;&#x2F;button&#x3E;
              &#x3C;button type=&#x22;button&#x22; class=&#x22;btn btn-info&#x22; data-dismiss=&#x22;modal&#x22; onclick=&#x22;addPortfolioAndReloadRightContentCard()&#x22; &#x3E;儲存&#x3C;&#x2F;button&#x3E;                                       
            &#x3C;&#x2F;div&#x3E;
          &#x3C;&#x2F;div&#x3E;        
      &#x3C;&#x2F;div&#x3E;
    &#x3C;&#x2F;div&#x3E;
    &#x3C;!--新增作品 Modal end--&#x3E;
</pre>

<p>public\js\portfolioIndex\addPortfolio.js</p>
<pre>
&#x2F;&#x2F;新增作品


  function buildAddPortfolioModalInfo(){
    $(&#x27;&#x23;addPortfolioForCategory&#x27;).text( $(&#x27;&#x23;RightContentTitle&#x27;).text() );
  }

  function cleanAddPortfolioModal(){
    $(&#x22;&#x23;insertPortfolioName&#x22;).val(&#x22;&#x22;);
    $(&#x22;&#x23;insertPortfolioDiscription&#x22;).val(&#x22;&#x22;);
  }

  function addPortfolioAndReloadRightContentCard(){
    var insertPortfolioName = $(&#x22;&#x23;insertPortfolioName&#x22;).val();
    var insertPortfolioDiscription = $(&#x22;&#x23;insertPortfolioDiscription&#x22;).val();
    var currentCategoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioAdd&#x27;,
      data: {
        insertPortfolioName : insertPortfolioName,
        insertPortfolioDiscription : insertPortfolioDiscription,
        currentCategoryId : currentCategoryId,
        &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
      } ,&#x2F;&#x2F;419
      success:function(result){
        $(&#x22;&#x23;RightContent&#x22;).html(result);
      },
      error:function(){
        console.log(&#x22;addPortfolioAndReloadRightContentCard() error&#x22;);
      }
    });
    cleanAddPortfolioModal();
  }
</pre>

<p>routes\web.php</p>
<pre>
Route::get(&#x27;&#x2F;portfolioAdd&#x27;,&#x27;portfolioController@insertPortfolioInDBAndReload&#x27;);
</pre>

<p>app\Http\Controllers\portfolioController.php</p>
<pre>
    public function insertPortfolioInDBAndReload(Request $reqeust){
        $db = new portfolio();
        $db-&#x3E;name = $reqeust-&#x3E;insertPortfolioName;        
        $db-&#x3E;discription = $reqeust-&#x3E;insertPortfolioDiscription;        
        $db-&#x3E;portfolio_category_id = $reqeust-&#x3E;currentCategoryId;        
        $db-&#x3E;sort = 0;                
        $db-&#x3E;save();                
        return $this-&#x3E;buildRightContent($reqeust);
    }

    function buildRightContent(Request $request){
        $db = new portfolio();
        $portfolioInfoFromDB = $db -&#x3E; findportfolioInfoByCategoryId($request-&#x3E;currentCategoryId);
        $RightContentHtml = &#x22;&#x22;;
            ......
        return $RightContentHtml;
    }
</pre>












      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/08/25/laravel/" data-id="cke9vbrc8000uggx150x76582" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-laravel-作品集11-撰寫左樹選單8-刪除分類" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/25/laravel-%E4%BD%9C%E5%93%81%E9%9B%8611-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE8-%E5%88%AA%E9%99%A4%E5%88%86%E9%A1%9E/" class="article-date">
  <time datetime="2020-08-25T10:55:00.000Z" itemprop="datePublished">2020-08-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/25/laravel-%E4%BD%9C%E5%93%81%E9%9B%8611-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE8-%E5%88%AA%E9%99%A4%E5%88%86%E9%A1%9E/">[laravel][作品集11] 撰寫左樹選單8-刪除分類</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4>刪除左樹選單中項目操作</h4>
如下圖操作，選擇左樹選單需要刪除的項目，並按下 [刪除分類] 後，便會跳出警告視窗。
若按下確定刪除，則會修改資料庫並於左樹選單移除該項目與子分類和其下作品。
在刪除此分類項目後，系統會自動跳到其上一層分類，也就是顯示被刪除項目的父分類。


<p><img src="/images/pasted-45.png" alt=""></p>
<h5>刪除分類的程式邏輯</h5>
本系統對左樹選單的分類刪除採軟刪除，也就是該被刪除的分類項目其資料庫欄位只是將 is_delete 改為1 (true) 而已，實際上還是存在於資料庫。
而其下的子分類與作品 is_delete 欄位與其他資料則不改變，因為到時還原其被刪除分類的時候，還能保持它底下的分類與作品的刪除狀態。


<hr>
<h4>顯示刪除警告訊息</h4>

<h5>button中的 onclick 與 data-target 運作順序</h5>
如 view portfolioIndex.blade.php 程式中，按下刪除分類後會使用 bootstrap 的 data-target 導向 刪除的警告的對話框 dialog ，在 bootstrap 中稱為 Modal 。
在按下刪除分類的 button，程式的運作順序是先執行 onclick的函式後，才會執行並顯示 Modal 對話框 。
我們可以利用這個機制事先在 onclick 的函示中事先做邏輯判斷後再處理 Modal 對話框的顯示訊息。
如下程式中，點選[刪除分類] 按鈕後，會先 onclick 觸發 buildDeleteCategoryModalInfo() 函式。


<p>resources\views\portfolioIndex.blade.php</p>
<pre>
&#x3C;script type=&#x22;text&#x2F;javascript&#x22; src=&#x22; URL::asset(&#x27;&#x2F;js&#x2F;portfolioIndex&#x2F;deleteCategoryInLeftTreeMenu.js&#x27;) &#x22;&#x3E;&#x3C;&#x2F;script&#x3E;

&#x3C;input type=&#x22;hidden&#x22; id=&#x22;currentCategoryId&#x22; value=&#x22;0&#x22;&#x3E;

&#x3C;div class=&#x22;row&#x22; style=&#x22;margin-top:20px&#x22;&#x3E;
  &#x3C;div class=&#x22;col-11&#x22; &#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; id=&#x27;addCategoryBtn&#x27; onclick=&#x27;buildAddCategoryHtml()&#x27; &#x3E;新增分類&#x3C;&#x2F;button&#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; id=&#x27;editCategoryBtn&#x27; onclick=&#x27;buildEditCategoryHtml()&#x27; &#x3E;重新命名分類&#x3C;&#x2F;button&#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-danger&#x27; data-toggle=&#x27;modal&#x27; onclick=&#x27;buildDeleteCategoryModalInfo()&#x27; data-target=&#x27;&#x23;deleteCategoryModal&#x27;  &#x3E;刪除分類&#x3C;&#x2F;button&#x3E;
  &#x3C;&#x2F;div&#x3E;
&#x3C;&#x2F;div&#x3E;

&#x3C;!-- 刪除分類警告訊息 --&#x3E;
&#x3C;div class=&#x22;modal&#x22; id=&#x22;deleteCategoryModal&#x22; tabindex=&#x22;-1&#x22; role=&#x22;dialog&#x22;  aria-hidden=&#x22;true&#x22; data-backdrop=&#x22;static&#x22;&#x3E;
  &#x3C;div class=&#x22;modal-dialog&#x22; role=&#x22;document&#x22;&#x3E;
    &#x3C;div class=&#x22;modal-content&#x22;&#x3E;
      &#x3C;div class=&#x22;modal-header&#x22;&#x3E;
        &#x3C;h5 class=&#x22;modal-title&#x22;&#x3E;警告!!&#x3C;&#x2F;h5&#x3E;
        &#x3C;button type=&#x22;button&#x22; class=&#x22;close&#x22; data-dismiss=&#x22;modal&#x22; aria-label=&#x22;Close&#x22;&#x3E;
          &#x3C;span aria-hidden=&#x22;true&#x22;&#x3E;&#x26;times;&#x3C;&#x2F;span&#x3E;
        &#x3C;&#x2F;button&#x3E;
      &#x3C;&#x2F;div&#x3E;
      &#x3C;div class=&#x22;modal-body&#x22;&#x3E;
        &#x3C;p id=&#x27;deleteCategoryModalInfo&#x27;&#x3E;&#x3C;&#x2F;p&#x3E;
      &#x3C;&#x2F;div&#x3E;
      &#x3C;div class=&#x22;modal-footer&#x22;&#x3E;        
        &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-danger&#x27; data-dismiss=&#x27;modal&#x27;  onclick=&#x27;deleteCategoryAjaxAndReloadTree()&#x27; id=&#x22;deleteCategoryModalBtn&#x22; &#x3E;確定刪除&#x3C;&#x2F;button&#x3E;
        &#x3C;button type=&#x22;button&#x22; class=&#x22;btn btn-secondary&#x22;  data-dismiss=&#x22;modal&#x22; &#x3E;取消&#x3C;&#x2F;button&#x3E;
      &#x3C;&#x2F;div&#x3E;
    &#x3C;&#x2F;div&#x3E;
  &#x3C;&#x2F;div&#x3E;
&#x3C;&#x2F;div&#x3E;
</pre>


<p>public\js\portfolioIndex\deleteCategoryInLeftTreeMenu.js</p>
<pre>
  function buildDeleteCategoryModalInfo(){
    var categoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    if(categoryId==0){
      $(&#x27;&#x23;deleteCategoryModalInfo&#x27;).text(&#x27;總目錄無法刪除!&#x27;);
      $(&#x22;&#x23;deleteCategoryModalBtn&#x22;).hide();
    }else{
      $(&#x27;&#x23;deleteCategoryModalInfo&#x27;).html(
        &#x27;確定要刪除分類 : &#x5C;&#x22;&#x27; + $(&#x27;&#x23;RightContentTitle&#x27;).text() +&#x27;&#x5C;&#x22; 嗎?&#x27;  +
        &#x27;該分類刪除後，此分類下的作品與子分類會一併刪除!!&#x27;             
      );
      $(&#x22;&#x23;deleteCategoryModalBtn&#x22;).show();
    }
  }
</pre>

<h5>於onclick的函式中判斷不同請況</h5>
在 buildDeleteCategoryModalInfo() 函式中，會先判斷目前的分類 id 是否為 0 ，也就是判斷是否為總目錄。
若為總目錄，警告訊息改為顯示 "總目錄無法刪除" 的訊息，並且將 [確定刪除] 按鈕 .hide() 隱藏，如下圖:

<p><img src="/images/pasted-46.png" alt=""></p>
<p>若是其他分類，則會提出其他警告，如下圖:</p>
<p><img src="/images/pasted-47.png" alt=""></p>
<hr>
<h4>資料庫對該分類進行軟刪除</h4>
回到剛剛 portfolioIndex.blade.php 程式中的刪除警告的對話框Modal ，若確定按下 [確定刪除] 的按鈕，會呼叫 deleteCategoryAjaxAndReloadTree() 函式。
該函示會將需要刪除的分類 id 藉由路由導向到 controller 程式中。

<p>public\js\portfolioIndex\deleteCategoryInLeftTreeMenu.js</p>
<pre>
  function deleteCategoryAjaxAndReloadTree(){
    var categoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    if(categoryId!=0){
      $.ajax({
        type:&#x27;GET&#x27;,
        url:&#x27;&#x2F;portfolioCategoryDelete&#x27;,
        data:{
            categoryId : categoryId,
          &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
        },
        success:function(result){
          if(result==1){            
            $(&#x27;&#x23;&#x27;+categoryId).next(&#x27;ul&#x27;).remove();
            $(&#x27;&#x23;&#x27;+categoryId).remove();
            backToParentCategory(categoryId);
          }else{
            alert(&#x22;刪除失敗&#x22;);
          }
        },error:function(){
          console.log(&#x22;deleteCategoryAjaxAndReloadTree error&#x22;);
        }
      });
    }    
  }
</pre>

<p>routes\web.php 路由導向到 portfolioController.php 程式中</p>
<pre>
Route::get('/portfolioCategoryDelete','portfolioController@deleteCategoryInDB');
</pre>

<p>app/Http/Controllers/portfolioController.php</p>
<pre>
    public function deleteCategoryInDB(Request $request){
        $db = portfolioCategory::find($request->categoryId);
        $db->is_delete = 1;
        return $db->save();                
    }
</pre>

<p>在 Controller 程式中，使用 deleteCategoryInDB() 函式，修改 is_delete 為 1 ，並 save() 完成軟刪除。</p>
<hr>
<h4>刪除後更新頁面</h4>
若資料庫成功修改程式，ajax() 會回傳 result == 1，
並使用 remove() 的方法，將該刪除分類其下的子分類 .next( 'ul' ) 先 remove 移除，再將該分類 li 也一起移除。
使用 backToParentCategory() 方法 ，回到上一層分類，也就是該被刪除分類的父分類。
<br><br>
在 getCategoryParentIdById() 方法中，使用 ajax() 回到 controller 取得目前分類的父分類 id 。
最後並在 backToParentCategory() 方法中退回父分類與更新右內容頁。

<p>public\js\portfolioIndex\deleteCategoryInLeftTreeMenu.js</p>
<pre>
  function deleteCategoryAjaxAndReloadTree(){
    var categoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    if(categoryId!=0){
      $.ajax({
            ......
        ,success:function(result){
          if(result==1){            
            $(&#x27;&#x23;&#x27;+categoryId).next(&#x27;ul&#x27;).remove();
            $(&#x27;&#x23;&#x27;+categoryId).remove();
            backToParentCategory(categoryId);
          }else{  alert(&#x22;刪除失敗&#x22;);    }
        },error:function(){
          console.log(&#x22;deleteCategoryAjaxAndReloadTree error&#x22;);
        }
      });
    }    
  }


function backToParentCategory(categoryId){
  var parentId = getCategoryParentIdById(categoryId);
  $(&#x27;&#x23;&#x27;+parentId).find(&#x27;span&#x27;).addClass(&#x27;font-weight-bolder text-info h5&#x27;); 
  $(&#x22;&#x23;RightContentTitle&#x22;).text( $(&#x27;&#x23;&#x27;+parentId).find(&#x27;span&#x27;).text() );  
  buildRightContentCard(parentId);       
}

function getCategoryParentIdById(categoryId){
    var parentId = 0;
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioCategoryGetParentId&#x27;,
      data:{
        categoryId : categoryId,
        &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
      },
      async : false,
      success:function(result){
        parentId = result;
      },
      error:function(){
        console.log(&#x22;getCategoryParentIdById error1&#x22;);
      }
    });
    return parentId;
}
</pre>

<p>routes\web.php</p>
<pre>
Route::get('/portfolioCategoryGetParentId','portfolioController@findCategoryParentIdById');
</pre>

<p>app/Http/Controllers/portfolioController.php</p>
<pre>
    public function findCategoryParentIdById(Request $request){        
        $db = portfolioCategory::find($request->categoryId);
        return $db->parent_id;
    }
</pre>

<hr>
<h4>呈現效果:</h4>
<img src='https://i.imgur.com/XzwLcl1.gif' />




      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/08/25/laravel-%E4%BD%9C%E5%93%81%E9%9B%8611-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE8-%E5%88%AA%E9%99%A4%E5%88%86%E9%A1%9E/" data-id="cke9vbrc0000eggx190jpfmer" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-laravel-作品集10-撰寫左樹選單7-修改分類名稱" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/25/laravel-%E4%BD%9C%E5%93%81%E9%9B%8610-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE7-%E4%BF%AE%E6%94%B9%E5%88%86%E9%A1%9E%E5%90%8D%E7%A8%B1/" class="article-date">
  <time datetime="2020-08-25T08:23:00.000Z" itemprop="datePublished">2020-08-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/25/laravel-%E4%BD%9C%E5%93%81%E9%9B%8610-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE7-%E4%BF%AE%E6%94%B9%E5%88%86%E9%A1%9E%E5%90%8D%E7%A8%B1/">[laravel][作品集10] 撰寫左樹選單7-修改分類名稱</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5>修改左樹選單選項名稱</h5>
上一篇文章已經說明新增分類的操作邏輯與撰寫方法，接下來討論如何修改左樹選單。
其操作邏輯如下圖，點選需要修改的項目後，按下 [重新命名分類] 後，該點選的項目會自動轉成輸入框。
此輸入框會保留原本名稱，修改後按下儲存，便刷新該頁面並存入資料庫。
![](/images/pasted-44.png)

<h5>按下 [重新命名分類] 後產生輸入框</h5>
點選需要修改的項目後，按下[重新命名]按鈕，呼叫buildEditCategoryHtml() 函式，後續的 js程式將分離到 editeCategoryInLeftTreeMenu.js 的程式中撰寫。

<pre>
&#x3C;script type=&#x22;text&#x2F;javascript&#x22; src=&#x22; URL::asset(&#x27;&#x2F;js&#x2F;portfolioIndex&#x2F;editeCategoryInLeftTreeMenu.js&#x27;) &#x22;&#x3E;&#x3C;&#x2F;script&#x3E;

......

&#x3C;input type=&#x22;hidden&#x22; id=&#x22;currentCategoryId&#x22; value=&#x22;0&#x22;&#x3E;

&#x3C;div class=&#x22;row&#x22; style=&#x22;margin-top:20px&#x22;&#x3E;
  &#x3C;div class=&#x22;col-11&#x22; &#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; id=&#x27;addCategoryBtn&#x27; onclick=&#x27;buildAddCategoryHtml()&#x27; &#x3E;新增分類&#x3C;&#x2F;button&#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; id=&#x27;editCategoryBtn&#x27; onclick=&#x27;buildEditCategoryHtml()&#x27; &#x3E;重新命名分類&#x3C;&#x2F;button&#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-danger&#x27; data-toggle=&#x27;modal&#x27; onclick=&#x27;buildDeleteCategoryModalInfo()&#x27; data-target=&#x27;&#x23;deleteCategoryModal&#x27;  &#x3E;刪除分類&#x3C;&#x2F;button&#x3E;
  &#x3C;&#x2F;div&#x3E;
&#x3C;&#x2F;div&#x3E;
</pre>


<p>在 buildEditCategoryHtml() 函式中，取得點選項目的id :CategoryId 與 點選項目名稱 categoryName。<br>與 新增分類的方法類似，使用 $(“#”+CategoryId).find(‘span’).replaceWith( … ) 方法，將 span 替換為輸入框。<br>如下editeCategoryInLeftTreeMenu.js 程式:</p>
<pre>
function buildEditCategoryHtml(){
    var CategoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    var categoryName = $(&#x22;&#x23;RightContentTitle&#x22;).text();
    cleanEditCategoryHtmlAndReloadSpan();
    if(CategoryId==0){
      alert(&#x22;無法修改總目錄名稱&#x22;);
    }else{
      $(&#x22;&#x23;&#x22;+CategoryId).find(&#x27;span&#x27;).replaceWith(
          &#x22;&#x3C;span  id=&#x27;edit_category_item&#x27;&#x3E;&#x22;
        +   &#x22;&#x3C;input type=&#x27;text&#x27; class=&#x27;form-control&#x27; value=&#x27;&#x22;+categoryName+&#x22;&#x27; id=&#x27;editCategoryNameInput&#x27;&#x3E;&#x22;
        +   &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-secondary&#x27; onclick=&#x27;cleanEditCategoryHtml()&#x27; &#x3E;取消&#x3C;&#x2F;button&#x3E;&#x22;
        +   &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; onclick=&#x27;editCategoryAjaxAndReloadTree()&#x27; &#x3E;儲存&#x3C;&#x2F;button&#x3E;&#x22;                
        + &#x22;&#x3C;&#x2F;span&#x3E;&#x22;
      );
    }
}
</pre>


<p>而按下取消則是使用 cleanEditCategoryHtmlAndReloadSpan() 函式，清除輸入框，並還原 span內的文字。<br>在後續成功將修改分類名稱存入資料庫後，也會使用此方法。</p>
<pre>
function cleanEditCategoryHtmlAndReloadSpan(){
    var categoryName = $(&#x22;&#x23;RightContentTitle&#x22;).text();
    $(&#x27;&#x23;edit_category_item&#x27;).replaceWith(
      &#x22;&#x3C;span id=&#x27;folder_span&#x27; &#x3E;&#x22; + categoryName +  &#x22;&#x3C;&#x2F;span&#x3E;&#x22;
    );    
    var CategoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    changeTreeWordingWeightBolder($(&#x22;&#x23;&#x22;+CategoryId).find(&#x22;span&#x22;));
}
</pre>


<hr>
<h5>按下[儲存] 後存入資料庫</h5>
於 editCategoryAjaxAndReloadTree() 函式中，使用ajax()導向 controller 程式。
在此之前，使用 .val() 取得輸入框的修改名稱 editCategoryName ，與當下的分類 id categoryId。
( 備註: 使用 script 標籤中URL::asset 引入 public 的 js 其 ajax() 只能使用 get 導向 )
使用 ajax 導向至路由。
<pre>
function editCategoryAjaxAndReloadTree(){
    var categoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    var editCategoryName = $(&#x22;&#x23;editCategoryNameInput&#x22;).val();
    $(&#x22;&#x23;RightContentTitle&#x22;).text(editCategoryName);  
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioCategoryEdit&#x27;,
      data:{
        categoryId : categoryId,
        categoryName : editCategoryName,
        &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
      },
      success:function(result){        
        if(result==1){
          if(categoryId&#x3E;0){            
              cleanEditCategoryHtmlAndReloadSpan();
          }
        }
      },error:function(){
        console.log(&#x22;editCategoryAjaxAndReloadTree error&#x22;);
      }
    });      
}
</pre>

<p>路由 routes / web.php</p>
<pre>
Route::get('/portfolioCategoryEdit','portfolioController@updateCategoryInDB');
</pre>

<p>藉由如上路由程式，導向到 portfolioController.php 的 updateCategoryInDB() 函式，並存入資料庫。</p>
<pre>
    public function updateCategoryInDB(Request $request){       
        $db = portfolioCategory::find($request-&#x3E;categoryId);
        $db-&#x3E;name = $request-&#x3E;categoryName;
        return $db-&#x3E;save();
    }
</pre>

<hr>
<h5>更新資料庫後刷新頁面</h5>
回到之前的 editCategoryAjaxAndReloadTree() 函式中，在剛剛 controller的 updateCategoryInDB() 函式若存入資料庫成功後會回傳 1 。
因此在  success:function() 中會取得 result 為 1 ，最後使用之前復原用的 cleanEditCategoryHtmlAndReloadSpan() 函示將修改的分類名稱更新至左樹選單中。


<h5>呈現效果:</h5>
<img src='https://i.imgur.com/rXNSNga.gif' />


<hr>
<h5>程式內容:</h5>

<p>public/js/portfolioIndex/editeCategoryInLeftTreeMenu.js</p>
<pre>
&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;
&#x2F;&#x2F;修改左樹選單分類名稱
$(document).ready(function(){
    $(&#x27;html&#x27;).click(function(e){
      if($(e).parents(&#x27;&#x23;edit_category_item&#x27;).length==0 &#x26;&#x26; e.target.id != &#x27;edit_category_item&#x27;
        &#x26;&#x26; e.target.id != &#x27;editCategoryBtn&#x27; &#x26;&#x26; e.target.id != &#x27;editCategoryNameInput&#x27;
      ){
        cleanEditCategoryHtmlAndReloadSpan();      
      }
    });
});


function buildEditCategoryHtml(){
    var CategoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    var categoryName = $(&#x22;&#x23;RightContentTitle&#x22;).text();
    cleanEditCategoryHtmlAndReloadSpan();
    if(CategoryId==0){
      alert(&#x22;無法修改總目錄名稱&#x22;);
    }else{
      $(&#x22;&#x23;&#x22;+CategoryId).find(&#x27;span&#x27;).replaceWith(
          &#x22;&#x3C;span  id=&#x27;edit_category_item&#x27;&#x3E;&#x22;
        +   &#x22;&#x3C;input type=&#x27;text&#x27; class=&#x27;form-control&#x27; value=&#x27;&#x22;+categoryName+&#x22;&#x27; id=&#x27;editCategoryNameInput&#x27;&#x3E;&#x22;
        +   &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-secondary&#x27; onclick=&#x27;cleanEditCategoryHtmlAndReloadSpan()&#x27; &#x3E;取消&#x3C;&#x2F;button&#x3E;&#x22;
        +   &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; onclick=&#x27;editCategoryAjaxAndReloadTree()&#x27; &#x3E;儲存&#x3C;&#x2F;button&#x3E;&#x22;                
        + &#x22;&#x3C;&#x2F;span&#x3E;&#x22;
      );
    }
}


function cleanEditCategoryHtmlAndReloadSpan(){
    var categoryName = $(&#x22;&#x23;RightContentTitle&#x22;).text();
    $(&#x27;&#x23;edit_category_item&#x27;).replaceWith(
      &#x22;&#x3C;span id=&#x27;folder_span&#x27; &#x3E;&#x22; + categoryName +  &#x22;&#x3C;&#x2F;span&#x3E;&#x22;
    );    
    var CategoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    changeTreeWordingWeightBolder($(&#x22;&#x23;&#x22;+CategoryId).find(&#x22;span&#x22;));
}


function editCategoryAjaxAndReloadTree(){
    var categoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    var editCategoryName = $(&#x22;&#x23;editCategoryNameInput&#x22;).val();
    $(&#x22;&#x23;RightContentTitle&#x22;).text(editCategoryName);  
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioCategoryEdit&#x27;,
      data:{
        categoryId : categoryId,
        categoryName : editCategoryName,
        &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
      },
      success:function(result){        
        if(result==1){
          if(categoryId&#x3E;0){            
            cleanEditCategoryHtmlAndReloadSpan();
          }
        }
      },error:function(){
        console.log(&#x22;editCategoryAjaxAndReloadTree error&#x22;);
      }
    });      
}
</pre>


<p>app\Http\Controllers\portfolioController.php</p>
<pre>
    public function updateCategoryInDB(Request $request){       
        $db = portfolioCategory::find($request->categoryId);
        $db->name = $request->categoryName;
        return $db->save();
    }
</pre>


<p>routes\web.php</p>
<pre>
Route::get('/portfolioCategoryEdit','portfolioController@updateCategoryInDB');
</pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/08/25/laravel-%E4%BD%9C%E5%93%81%E9%9B%8610-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE7-%E4%BF%AE%E6%94%B9%E5%88%86%E9%A1%9E%E5%90%8D%E7%A8%B1/" data-id="cke9vbrby0009ggx18zo5eq4u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-作品集9-撰寫左樹選單6-新增分類後更新左樹選單" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/13/%E4%BD%9C%E5%93%81%E9%9B%869-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE6-%E6%96%B0%E5%A2%9E%E5%88%86%E9%A1%9E%E5%BE%8C%E6%9B%B4%E6%96%B0%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE/" class="article-date">
  <time datetime="2020-08-13T11:15:00.000Z" itemprop="datePublished">2020-08-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/13/%E4%BD%9C%E5%93%81%E9%9B%869-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE6-%E6%96%B0%E5%A2%9E%E5%88%86%E9%A1%9E%E5%BE%8C%E6%9B%B4%E6%96%B0%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE/">[laravel][作品集9] 撰寫左樹選單6-新增分類後更新左樹選單</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4>新增分類的操作邏輯</h4>
規劃若使用者需要新增分類，先點選需要在新增的父分類，按下 [新增分類] 就會在父分類下產生新增分類的輸入框。例如我想在 "大學作品" 的分類中新增其他分類，就先點選 "大學作品" 然後再按下 "新增分類" 按鈕，如下圖:

<p>但按下儲存後，會將分類資料存入資料庫並重新刷新該層左樹選單。<br><img src="/images/pasted-38.png" alt=""></p>
<hr>
<h4>按下儲存後新增分類存入資料庫</h4>

<h5>ajax() 導向到 controller</h5>
上一篇文章中所提，在輸入框按下儲存後，會使用addCategoryAjaxAndReloadTree() 函式中的 ajax() 導向到 controller 並存入資料庫。
因為輸入框產生是使用 jquery 的 .prepend() 等方法去組串 html ，因此並不好將分類 id 帶入addCategoryAjaxAndReloadTree() 方法中，
所以在前章節中每次點選左樹選單會儲存目前分類 id 於 input hidden 中。

<p>所以進入addCategoryAjaxAndReloadTree() 函式中使用 $(“#id”).val() 取得目前點選的分類 id 與 新增的分類名稱，並使用 ajax() 的值使用 post 導向到 controller 。<br>而導向出去的 ajax() 方法一樣需要設定為非同步 async : false ，要不 ajax() 為同步的狀態下在addCategoryAjaxAndReloadTree() 函式中一樣是最後執行，如下程式:</p>
<pre>
function buildAddCategoryHtml(){
......
  $(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).prepend( 
    &#x22;&#x3C;li id=&#x27;add_category_item&#x27; class=&#x27;list-group-item&#x27;&#x3E;&#x22;    
      + &#x22;&#x3C;input type=&#x27;text&#x27; class=&#x27;form-control&#x27; placeholder=&#x27;請輸入新增分類&#x27; value=&#x27;&#x27; id=&#x27;addCategoryNameInput&#x27;&#x3E;&#x22;
        ......
      + &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27;onclick=&#x27;addCategoryAjaxAndReloadTree()&#x27; &#x3E;儲存&#x3C;&#x2F;button&#x3E;&#x22;            
    + &#x22;&#x3C;&#x2F;li&#x3E;&#x22;
  );
}

function addCategoryAjaxAndReloadTree(){
  var categoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
  var categoryName = $(&#x22;&#x23;addCategoryNameInput&#x22;).val();  
  $.ajax({
    type:&#x27;POST&#x27;,
    url:&#x27;&#x2F;portfolioCategory&#x27;,
    data:{
      categoryId : categoryId,
      categoryName : categoryName,
      &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
    },
    async : false,
    success:function(result){ ...... }
    ......
}
    ......
&#x3C;input type=&#x22;hidden&#x22; id=&#x22;currentCategoryId&#x22; value=&#x22;0&#x22;&#x3E;
</pre>

<h5>controller 將新增分類存入資料庫</h5>
在 routes / web.php 路由器中，post 導向到 controller 的 insertCategoryInDB() 函式中:
<pre>
Route::post('/portfolioCategory','portfolioController@insertCategoryInDB');
</pre>

<p>controller 的 insertCategoryInDB() 函式從  Request 取得 ajax() 帶來的該新增分類名稱與目前被選取的分類 id ，也就是此新增分類的父分類。<br>將作品分類Model存入 $db ，$db = new portfolioCategory() ，將新增的分類名稱與其父分類 id 存入資料庫 $db-&gt;save() 。</p>
<pre>
&#x3C;?php
namespace App&#x5C;Http&#x5C;Controllers;
use Illuminate&#x5C;Http&#x5C;Request;
use App&#x5C;portfolioCategory;
    ......
class portfolioController extends Controller
{
    ......
    public function insertCategoryInDB(Request $request){
        $db = new portfolioCategory();
        $db-&#x3E;name = $request-&#x3E;categoryName;
        $db-&#x3E;parent_id = $request-&#x3E;categoryId;
        $db-&#x3E;sort = 0;        
        return $db-&#x3E;save();
    }
}
</pre>

<hr>
<h4>重新刷新顯示下一層與新節點</h4>

<p>將新增分類從 controller 存入資料庫後，重新 return 回 ajax() 。因為 ajax() 設為非同步 async : false ，所以執行完 ajax() 後下一個執行 reloadNextLevelByThisNodeForTreeMenu() 函式 。</p>
<p>在 reloadNextLevelByThisNodeForTreeMenu() 函式中將該選取的分類下一層子項目 ul 清除後，重新刷新該層。</p>
<pre>
function addCategoryAjaxAndReloadTree(){
  var categoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
  var categoryName = $(&#x22;&#x23;addCategoryNameInput&#x22;).val();  
  $.ajax({
    type:&#x27;POST&#x27;,
    url:&#x27;&#x2F;portfolioCategory&#x27;,
    data:{
      categoryId : categoryId,
      categoryName : categoryName,
      &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
    },
    async : false,
    success:function(result){
      console.log(&#x22;result: &#x22;+result);
    },error:function(){
      console.log(&#x22;addCategoryAjax error&#x22;);
    }
  });
  reloadNextLevelByThisNodeForTreeMenu(categoryId);
}

function reloadNextLevelByThisNodeForTreeMenu(categoryId){  
  $(&#x27;&#x23;&#x27;+categoryId).next(&#x27;ul&#x27;).html(&#x27;&#x27;);
  buildNextLevelByThisNodeIdForTreeMenu(categoryId);  
}

function buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId){
  $.ajax({
    type:&#x27;GET&#x27;,
    url:&#x27;&#x2F;portfolioTreeMenuThisNodeBuildNextLevel&#x27;,
    data: { ...... },
    async : false,
    success:function(result){ ...... } ......
  });
}
</pre>

<h4>新增分類與刷新效果</h4>

<img src="https://i.imgur.com/gLj3Le1.gif" />

<hr>
<h5>從view中分離出 js ，使用 asset 引入 js</h5>
可以將撰寫的 &#x3C;script&#x3E; 功能的 js 分離到到 public &#x2F; js &#x2F; 的目錄下:

<p><img src="/images/pasted-42.png" alt=""></p>
<p>將前面撰寫的新增分類的 js 程式，移到 addCategoryInLeftTreeMenu.js 程式中，<br>並在 view 中使用 script 將該 js 引入view 中， src 使用 { { URL :: asset( ‘/js/… ‘ ) } } 引入。</p>
<pre>
&#x3C;script type=&#x22;text&#x2F;javascript&#x22; src=&#x22; URL::asset(&#x27;&#x2F;js&#x2F;portfolioIndex&#x2F;buildLeftTreeMenu.js&#x27;) &#x22;&#x3E;&#x3C;&#x2F;script&#x3E;
&#x3C;script type=&#x22;text&#x2F;javascript&#x22; src=&#x22; URL::asset(&#x27;&#x2F;js&#x2F;portfolioIndex&#x2F;addCategoryInLeftTreeMenu.js&#x27;) &#x22;&#x3E;&#x3C;&#x2F;script&#x3E;
</pre>

<p>參考資料:<br><a href="https://blog.csdn.net/qq_28018283/article/details/53114446" target="_blank" rel="noopener">https://blog.csdn.net/qq_28018283/article/details/53114446</a></p>
<h5>引入 js 中ajx() 使用 post 造成 419 錯誤</h5>
在 addCategoryInLeftTreeMenu.js 程式中，使用 addCategoryAjaxAndReloadTree() 中的 ajax() 其使用 post 方法會造成 419 錯誤，data 參數使用 "_token": " csrf_token()  也沒用，產生如下錯誤:

<p><img src="/images/pasted-43.png" alt=""></p>
<p>該 ajax() 改為 GET 暫時處理此問題，需要再追蹤。</p>
<p>addCategoryInLeftTreeMenu.js 程式:</p>
<pre>
&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;
&#x2F;&#x2F;新增左樹選單分類
$(document).ready(function(){
    $(&#x27;html&#x27;).click(function(e){
      if($(e).parents(&#x27;&#x23;add_category_item&#x27;).length==0 &#x26;&#x26; e.target.id != &#x27;add_category_item&#x27;
        &#x26;&#x26; e.target.id != &#x27;addCategoryBtn&#x27; &#x26;&#x26; e.target.id != &#x27;addCategoryNameInput&#x27;
      ){
        cleanAddCategoryHtml();      
      }
    });
});

  function buildAddCategoryHtml(){
    cleanAddCategoryHtml();
    var CategoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    $(&#x22;&#x23;&#x22;+CategoryId).find(&#x27;img&#x27;).attr(&#x27;src&#x27;,&#x27;&#x2F;icon&#x2F;folder-open.png&#x27;);  
    $(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).show(&#x22;slow&#x22;);

    if($(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).length == 0)
      buildNextLevelByThisNodeIdForTreeMenu(CategoryId);      

    $(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).prepend(
        &#x22;&#x3C;li id=&#x27;add_category_item&#x27; class=&#x27;list-group-item&#x27;&#x3E;&#x22;    
        + &#x22;&#x3C;input type=&#x27;text&#x27; class=&#x27;form-control&#x27; placeholder=&#x27;請輸入新增分類&#x27; value=&#x27;&#x27; id=&#x27;addCategoryNameInput&#x27;&#x3E;&#x22;
        + &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-secondary&#x27;onclick=&#x27;cleanAddCategoryHtml()&#x27; &#x3E;取消&#x3C;&#x2F;button&#x3E;&#x22;
        + &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27;onclick=&#x27;addCategoryAjaxAndReloadTree()&#x27; &#x3E;儲存&#x3C;&#x2F;button&#x3E;&#x22;            
      + &#x22;&#x3C;&#x2F;li&#x3E;&#x22;
    );
  }

  function cleanAddCategoryHtml(){
    $(&#x27;&#x23;add_category_item&#x27;).remove();
  }

function addCategoryAjaxAndReloadTree(){
    var categoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
    var categoryName = $(&#x22;&#x23;addCategoryNameInput&#x22;).val();  
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioCategoryAdd&#x27;,
      data:{
        categoryId : categoryId,
        categoryName : categoryName,
        &#x22;_token&#x22;: &#x22; csrf_token() &#x22;
      },
      async : false,
      success:function(result){
        console.log(&#x22;result: &#x22;+result);
      },error:function(){
        console.log(&#x22;addCategoryAjax error&#x22;);
      }
    });
    reloadNextLevelByThisNodeForTreeMenu(categoryId);
}
</pre>

<p>buildLeftTreeMenu.js 程式:</p>
<pre>
......
function buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId){
  $.ajax({
    type:&#x27;GET&#x27;,
    url:&#x27;&#x2F;portfolioTreeMenuThisNodeBuildNextLevel&#x27;,
    data: { ...... },
    async : false,
    success:function(result){ ...... } ......
  });
}
    ......
function reloadNextLevelByThisNodeForTreeMenu(categoryId){  
  $(&#x27;&#x23;&#x27;+categoryId).next(&#x27;ul&#x27;).html(&#x27;&#x27;);
  buildNextLevelByThisNodeIdForTreeMenu(categoryId);  
}  
</pre>



<h5>後續編輯與刪除分類</h5>
後續章節中還須設計編輯分類與刪除分類功能，
其編輯分類的邏輯與撰寫方法與新增相似。





      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/08/13/%E4%BD%9C%E5%93%81%E9%9B%869-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE6-%E6%96%B0%E5%A2%9E%E5%88%86%E9%A1%9E%E5%BE%8C%E6%9B%B4%E6%96%B0%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE/" data-id="cke9vbrca0010ggx10t702wzh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ajax/" rel="tag">ajax()</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-作品集8-撰寫左樹選單5-產生-新增分類-輸入框" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/13/%E4%BD%9C%E5%93%81%E9%9B%868-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE5-%E7%94%A2%E7%94%9F-%E6%96%B0%E5%A2%9E%E5%88%86%E9%A1%9E-%E8%BC%B8%E5%85%A5%E6%A1%86/" class="article-date">
  <time datetime="2020-08-13T01:02:00.000Z" itemprop="datePublished">2020-08-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/13/%E4%BD%9C%E5%93%81%E9%9B%868-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE5-%E7%94%A2%E7%94%9F-%E6%96%B0%E5%A2%9E%E5%88%86%E9%A1%9E-%E8%BC%B8%E5%85%A5%E6%A1%86/">[laravel][作品集8] 撰寫左樹選單5-產生[新增分類]輸入框</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4>新增分類的操作邏輯</h4>
規劃若使用者需要新增分類，先點選需要在新增的父分類，按下 [新增分類] 就會在父分類下產生新增分類的輸入框。例如我想在 "大學作品" 的分類中新增其他分類，就先點選 "大學作品" 然後再按下 "新增分類" 按鈕，如下圖:

<p><img src="/images/pasted-38.png" alt=""></p>
<hr>
<h4>新增按鈕與顯示新增分類輸入框</h4>
首先於左樹選單上方新增對分類的 "新增"、"重新命名"、"刪除" 三個功能的按鈕，如下圖:

<p><img src="/images/pasted-39.png" alt=""></p>
<p>使用 div row 將功能按鈕整理同一行，方便操作，功能按鈕程式如下:</p>
<pre>
&#x3C;div class=&#x22;row&#x22; style=&#x22;margin-top:20px&#x22;&#x3E;
  &#x3C;div class=&#x22;col-11&#x22; &#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; id=&#x27;addCategoryBtn&#x27; onclick=&#x27;buildAddCategoryHtml()&#x27; &#x3E;新增分類&#x3C;&#x2F;button&#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; id=&#x27;editCategoryBtn&#x27; onclick=&#x27;&#x27; &#x3E;重新命名分類&#x3C;&#x2F;button&#x3E;
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-danger&#x27; data-toggle=&#x27;modal&#x27; data-target=&#x27;&#x27; onclick=&#x27;&#x27; &#x3E;刪除分類&#x3C;&#x2F;button&#x3E;
  &#x3C;&#x2F;div&#x3E;
&#x3C;&#x2F;div&#x3E;
</pre>

<h5>儲存分類id</h5>
點選[新增分類]按鈕後，執行 buildAddCategoryHtml()函式，需要對目前點選的分類項目，也就是左樹選單的 span 進行操作，例如展開節點、開啟圖片等等...。<br>
此時就需要知道當前點選的分類 id 是多少 ，因此在之前章節的程式中，$("#LeftTreeMenu").on("click", "span" ,function() 點選 span的項目時就需要儲存當前的分類 id 。最適合就是將其存在 input hidden 的參數中，如下:
<pre>
$(&#x22;&#x23;LeftTreeMenu&#x22;).on(&#x22;click&#x22;, &#x22;span&#x22; ,function(){
        ......
    $(&#x22;&#x23;currentCategoryId&#x22;).val(ThisNodeCategoryId);     
        ......
});
    ......
&#x3C;input type=&#x22;hidden&#x22; id=&#x22;currentCategoryId&#x22; value=&#x22;0&#x22;&#x3E;
</pre>


<p>儲存完分類 id 後，再回到點選 [新增分類] 所onclick 觸發的 buildAddCategoryHtml() 方法，先取得前面所撰寫所儲存的 分類 id ，並將其父分類的 資料夾圖示與 ul 都展開顯示:</p>
<pre>
function buildAddCategoryHtml(){
    var CategoryId = $("#currentCategoryId").val();
    $("#"+CategoryId).find('img').attr('src','/icon/folder-open.png');  
    $("#"+CategoryId).next('ul').show("slow");
    ......
}
</pre>


<h5>新增分類輸入框相關位置</h5>
如下圖，在[大學作品]的 li 項目下一個位置，產生 ul ，而新增分類的輸入框，則是包覆在 ul 內的第一個 li 。

<p><img src="/images/pasted-40.png" alt=""></p>
<h5>判斷是否已經產生下一層</h5>
回到之前文章談的左樹選單產生邏輯，點選該項目之後才會產生此項目的下一層子項目。因此需要顯示新增分類的輸入框之前，需要先判斷是否有產生下一層的子項目，若沒有的話就使用之前的 buildNextLevelByThisNodeIdForTreeMenu() 方法產生下一層 <br>
(但此重新呼叫此方法就需要將此方法中的 ajax 改為非同步 async : false ，這部分會在後面的部分中說明。 )<br>
所以  $("#"+CategoryId).next('ul').length 是否為 0 ，判斷 ul 是否有子節點項目，為0 就執行產生下一層的動作。

<pre>
function buildAddCategoryHtml(){
    ......
    if($("#"+CategoryId).next('ul').length == 0)
        buildNextLevelByThisNodeIdForTreeMenu(CategoryId);      
    ......
}
</pre>

<h5>將串下一層樹節點函式的 ajax() 設定非同步</h5>
在最一開始產生左樹選單與產生下一層節點所撰寫的 buildNextLevelByThisNodeIdForTreeMenu() 函數，須將其改為非同步。ajax() 函式一開始預設為同步，ajax() 在同步的情況下會將 ajax() 外部的程式執行完後，最後才會執行 ajax() 內的動作。<br>

<p>所以若ajax() 是同步的情況下，在 buildAddCategoryHtml() 方法中執行順序將會變成先產生輸入框，但輸入框需要於該項目的下一個 ul 中產出，可是此時ajax() 並未執行產生下一層，ul 也沒有產生出來，無法產生輸入框。最後會執行 ajax() 產生下一層節點。<br></p>
<p>承上造成的操作情況為，若該左樹選單的項目還未產生，點選第一次 [新增分類] 只會產生出下一層子項目，不會顯示輸入框。<br><br>直到點選第二次 [新增分類] 才會產生出輸入框，此並不符合預期的操作邏輯，如下:</p>
<img src="https://i.imgur.com/HiItxHc.gif" />


<p>將該ajax()程式改為非同步，如下程式:</p>
<pre>
function buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId){
  $.ajax({
    type:'GET',
    url:'/portfolioTreeMenuThisNodeBuildNextLevel',
    data: { ...... },
    async : false,
    success:function(result){ ...... } ......
  });
}
</pre>

<p>改為非同步後，點選一次即可正常顯示:<br><img src="https://i.imgur.com/7QqBT7x.gif" /></p>
<h5>於ul內產生新增分類輸入框</h5>
在該被點選的分類項目 id 中，使用 .next( 'ul' ).prepend( ... ) 就是在該 ul 標籤內的第一個項目位置 .prepend() 產生輸入框。另位輸入框 li 的 id 固定為 add_category_item ，方便後續刪除。
<pre>
function buildAddCategoryHtml(){
    ......
  $(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).prepend(
    &#x22;&#x3C;li id=&#x27;add_category_item&#x27; class=&#x27;list-group-item&#x27;&#x3E;&#x22;    
        + &#x22;&#x3C;input type=&#x27;text&#x27; class=&#x27;form-control&#x27; placeholder=&#x27;請輸入新增分類&#x27; value=&#x27;&#x27; id=&#x27;addCategoryNameInput&#x27;&#x3E;&#x22;
        + &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-secondary&#x27;onclick=&#x27;cleanAddCategoryHtml()&#x27; &#x3E;取消&#x3C;&#x2F;button&#x3E;&#x22;
        + &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27;onclick=&#x27;addCategoryAjaxAndBuildHtml()&#x27; &#x3E;儲存&#x3C;&#x2F;button&#x3E;&#x22;            
    +&#x22;&#x3C;&#x2F;li&#x3E;&#x22;
  );
}
</pre>

<hr>
<h4>移除 ul 內產生的分類輸入框</h4>

<h5>移除方法remove()</h5>
輸入完新增分類後自然就需要將該對話框移除，而移除的方法很簡單，在前面產生輸入框時就已經將 id 設定為 add_category_item ，因此搭配 .remove() 方法就可以移出該 li 項目，如: $('#add_category_item').remove(); 。

<h5>產生與取消情況進行 remove() </h5>
在按下 [新增分類] 的按鈕後，就是執行 buildAddCategoryHtml() 的方法，但每次按該按鈕產生輸入框前都需要在開始執行先執行舊的輸入框清出的動作，要不就會造成重複按 [新增分類] 按鈕會一直重複產生。
另外若按下該輸入框的取消按鈕，自然也要執行清除輸入框動作，下列程式將 $('#add_category_item').remove(); 的清除語法放在 cleanAddCategoryHtml() 函式中方便之後 reuse。

<pre>
&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; id=&#x27;addCategoryBtn&#x27; onclick=&#x27;buildAddCategoryHtml()&#x27; &#x3E;新增分類&#x3C;&#x2F;button&#x3E;
    ......
function buildAddCategoryHtml(){
  cleanAddCategoryHtml();
    ......
  $(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).prepend(
    ......
      + &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-secondary&#x27;onclick=&#x27;cleanAddCategoryHtml()&#x27; &#x3E;取消&#x3C;&#x2F;button&#x3E;&#x22;
    ......
  );
}
</pre>

<h5>點選輸入框以外的位置時執行清除動作</h5>
為了方便操作，使用者再點選該輸入框以外的地方皆會將該輸入框清除。使用 $('html').click( function( e ){ ... } 的方法，在頁面的 html標籤被點選便開始判斷，若不是點選輸入框相關元件，或 新增分類按鈕的情況便刪除輸入框。
$('html').click( function( e ){ ... } 帶入的 e 便是被點選事件，使用 e.target.id 便可以知道被點選的元件 id 進一步作排除，完成程式如下:

<pre>
$(document).ready(function(){
  $(&#x27;html&#x27;).click(function(e){
    if($(e).parents(&#x27;&#x23;add_category_item&#x27;).length==0 &#x26;&#x26; e.target.id != &#x27;add_category_item&#x27;
      &#x26;&#x26; e.target.id != &#x27;addCategoryBtn&#x27; &#x26;&#x26; e.target.id != &#x27;addCategoryNameInput&#x27;
    ){
      cleanAddCategoryHtml();      
    }
  });
});
</pre>

<p>效果如下，點選輸入框或新增分類按鈕其他的地方，輸入框會消失。<br><img src="https://i.imgur.com/pd3lSUT.gif" /></p>
<p>總結完整程式如下，在 view 中撰寫:</p>
<pre>
&#x3C;script&#x3E;
$(document).ready(function(){
  $(&#x27;html&#x27;).click(function(e){
    if($(e).parents(&#x27;&#x23;add_category_item&#x27;).length==0 &#x26;&#x26; e.target.id != &#x27;add_category_item&#x27;
      &#x26;&#x26; e.target.id != &#x27;addCategoryBtn&#x27; &#x26;&#x26; e.target.id != &#x27;addCategoryNameInput&#x27;
    ){
      cleanAddCategoryHtml();      
    }
  });
});


function buildAddCategoryHtml(){
  cleanAddCategoryHtml();
  var CategoryId = $(&#x22;&#x23;currentCategoryId&#x22;).val();
  $(&#x22;&#x23;&#x22;+CategoryId).find(&#x27;img&#x27;).attr(&#x27;src&#x27;,&#x27;&#x2F;icon&#x2F;folder-open.png&#x27;);  
  $(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).show(&#x22;slow&#x22;);


  if($(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).length == 0)
    buildNextLevelByThisNodeIdForTreeMenu(CategoryId);      

  $(&#x22;&#x23;&#x22;+CategoryId).next(&#x27;ul&#x27;).prepend(
      &#x22;&#x3C;li id=&#x27;add_category_item&#x27; class=&#x27;list-group-item&#x27;&#x3E;&#x22;    
      + &#x22;&#x3C;input type=&#x27;text&#x27; class=&#x27;form-control&#x27; placeholder=&#x27;請輸入新增分類&#x27; value=&#x27;&#x27; id=&#x27;addCategoryNameInput&#x27;&#x3E;&#x22;
      + &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-secondary&#x27;onclick=&#x27;cleanAddCategoryHtml()&#x27; &#x3E;取消&#x3C;&#x2F;button&#x3E;&#x22;
      + &#x22;&#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27;onclick=&#x27;addCategoryAjaxAndBuildHtml()&#x27; &#x3E;儲存&#x3C;&#x2F;button&#x3E;&#x22;            
    + &#x22;&#x3C;&#x2F;li&#x3E;&#x22;
  );
}

function cleanAddCategoryHtml(){
  $(&#x27;&#x23;add_category_item&#x27;).remove();
}

function buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId){
  $.ajax({
    type:&#x27;GET&#x27;,
    url:&#x27;&#x2F;portfolioTreeMenuThisNodeBuildNextLevel&#x27;,
    data: { ...... },
    async : false, &#x2F;&#x2F; ajax() 改為非同步，可讓其在產生輸入框前先產生下一層子項目
    success:function(result){ ...... } ......
  });
}
&#x3C;&#x2F;script&#x3E;
......
    &#x3C;button type=&#x27;button&#x27; class=&#x27;btn btn-info&#x27; id=&#x27;addCategoryBtn&#x27; onclick=&#x27;buildAddCategoryHtml()&#x27; &#x3E;新增分類&#x3C;&#x2F;button&#x3E;
</pre>





      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/08/13/%E4%BD%9C%E5%93%81%E9%9B%868-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE5-%E7%94%A2%E7%94%9F-%E6%96%B0%E5%A2%9E%E5%88%86%E9%A1%9E-%E8%BC%B8%E5%85%A5%E6%A1%86/" data-id="cke9vbrc9000xggx17e7yby6s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-svn-svn-commit-遇到-ending-style-錯誤" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/12/svn-svn-commit-%E9%81%87%E5%88%B0-ending-style-%E9%8C%AF%E8%AA%A4/" class="article-date">
  <time datetime="2020-08-12T02:05:00.000Z" itemprop="datePublished">2020-08-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/svn-%E9%9A%A8%E7%AD%86%E8%A8%98/">svn 隨筆記</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/12/svn-svn-commit-%E9%81%87%E5%88%B0-ending-style-%E9%8C%AF%E8%AA%A4/">[svn] svn commit 遇到 ending style 錯誤</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4>[svn] svn commit 遇到 ending style 錯誤</h4>

<p>使用 svn commit 檔案時 (通常是 .xml 檔案 ) 出現  ending style 錯誤</p>
<ul>
    <li>key word : Inconsistent line ending style</li>
    <li>svn 缺少換行符(EOL )所造成錯誤</li>
</ul>


<h5>錯誤畫面:</h5>

<p><img src="/images/pasted-32.png" alt=""></p>
<p><img src="/images/pasted-33.png" alt=""></p>
<h5>解決方法:</h5>

<ul>
<li>notepad ++ 開啟該檔案</li>
<li>檢視 &gt; 特殊字源 &gt; EOL</li>
</ul>
<p><img src="/images/pasted-34.png" alt=""></p>
<ul>
<li>有些只有 LF, 就需要用 [換行格式] 編譯</li>
<li>需要有 CR LF</li>
</ul>
<p><img src="/images/pasted-35.png" alt=""></p>
<p>編輯 &gt; 換行格式 &gt; UNIX / Windows</p>
<ul>
<li>UNIX 與 Windows 兩者互相切換</li>
<li>當確認 ending style 都有CR LF後<br><img src="/images/pasted-36.png" alt=""></li>
</ul>
<hr>
<h4>(延伸) 關於 換行(EOL, end-of-line ) 與 CR LF</h4>
換行 (newline、line ending、end-of-line (EOL)、line Feed (LF)、line break )
<ul>      
    <li>在計算機領域中是一種加在文字最後位置的特殊字元，在換行字元的下一個字元將會出現在下一行</li>
    <li>換行字元根據不同的硬體平台或作業系統平台會有不同的編碼方式</li>
</ul>      


<p>關於 CR LF<br>以ASCII為基礎的或相容的字元集使用分別LF 或CR 或CR+LF</p>
<ul>      
    <li>LF：在Unix或Unix相容系統（GNU/Linux，AIX，Xenix，Mac OS X，...）</li>
    <li>CR：Apple II家族，Mac OS至版本9 </li>
    <li>CR+LF：DOS（MS-DOS、PC-DOS等）、微軟視窗作業系統（Microsoft Windows）、大部分非Unix的系統</li>
</ul>      


<p>Unicode標準指定以下的字元為相容標準的應用程式應辨識的換行字元</p>
<ul>      
    <li>LF：   換行，U+000A </li>
    <li>CR：   回車字元，U+000D </li>
    <li>CR+LF：CR（U+000D）後跟LF（U+000A） </li>
    <li>等等 ...... </li>
</ul>      

<p>參考資料<br><br><a href="https://zh.wikipedia.org/wiki/%E6%8F%9B%E8%A1%8C" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E6%8F%9B%E8%A1%8C</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/08/12/svn-svn-commit-%E9%81%87%E5%88%B0-ending-style-%E9%8C%AF%E8%AA%A4/" data-id="cke9vbrcd0017ggx1gwsbcn1y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/svn/" rel="tag">svn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8F%9B%E8%A1%8C%E7%AC%A6%E8%99%9F/" rel="tag">換行符號</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%B7%A8%E7%A2%BC/" rel="tag">編碼</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Eclipse-編譯-The-project-was-not-built-since-its-build-path-is-incomplete" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/11/Eclipse-%E7%B7%A8%E8%AD%AF-The-project-was-not-built-since-its-build-path-is-incomplete/" class="article-date">
  <time datetime="2020-08-11T11:30:00.000Z" itemprop="datePublished">2020-08-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E4%BD%9C%E7%AD%86%E8%A8%98/">工作筆記</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/11/Eclipse-%E7%B7%A8%E8%AD%AF-The-project-was-not-built-since-its-build-path-is-incomplete/">[Eclipse][編譯] The project was not built since its build path is incomplete.</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[環境][編譯] The project was not built since its build path is incomplete.<br>Eclispe 出現錯誤</p>
<p><img src="/images/pasted-28.png" alt="錯誤畫面"></p>
<h5>錯誤訊息</h5>
Description Resource Path Location Type  說明資源路徑位置類型
The project was not built since its build path is incomplete. 
Cannot find the class file for java.lang.Object. Fix the build path then try building this project xxx  Unknown Java Problem
由於構建路徑不完整，因此未構建項目。找不到java.lang.Object的類文件。 修復構建路徑，然後嘗試構建該項目xxx未知Java問題

<h5>解決方法</h5>
Eclipse 操作路徑:<br>
project > properties > java build path > LIbrary 標籤 > Add Library 按鈕
<ul>
      <li>選 JRE System Library</li>
    <li>選 Workspace default JRE (jdk 1.8.0 xxx )</li>
</ul>

<p><img src="/images/pasted-29.png" alt="選JRE System Library"></p>
<p><img src="/images/pasted-30.png" alt="選 Workspace default JRE"></p>
<p>最後在 libraries 的標籤中會出現 JRE System Library 項目，重新 clean porject 與 refresh 即正常</p>
<p><img src="/images/pasted-31.png" alt="libraries 標籤"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/08/11/Eclipse-%E7%B7%A8%E8%AD%AF-The-project-was-not-built-since-its-build-path-is-incomplete/" data-id="cke9vbrbk0000ggx16hbc1ii1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Eclipse/" rel="tag">Eclipse</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%B7%A8%E8%AD%AF/" rel="tag">編譯</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-laravel-作品集7-撰寫左樹選單4-按下選單後對應右內容頁" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/01/laravel-%E4%BD%9C%E5%93%81%E9%9B%867-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE4-%E6%8C%89%E4%B8%8B%E9%81%B8%E5%96%AE%E5%BE%8C%E5%B0%8D%E6%87%89%E5%8F%B3%E5%85%A7%E5%AE%B9%E9%A0%81/" class="article-date">
  <time datetime="2020-08-01T02:06:00.000Z" itemprop="datePublished">2020-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/01/laravel-%E4%BD%9C%E5%93%81%E9%9B%867-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE4-%E6%8C%89%E4%B8%8B%E9%81%B8%E5%96%AE%E5%BE%8C%E5%B0%8D%E6%87%89%E5%8F%B3%E5%85%A7%E5%AE%B9%E9%A0%81/">[laravel][作品集7] 撰寫左樹選單4-按下選單後對應右內容頁</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>規劃設計一個能有左選單樹進行分類的作品集介面，如下圖:<br><img src="/images/pasted-1.png" alt="圖:預計畫面"></p>
<p>依照之前定義的操作邏輯，點選左樹選單的 span 標籤內的文字後，右內容頁面的上方 title 會產生分類名稱，並且右內容頁會產生縮圖元件來顯示作品內容。</p>
<hr>
依照前篇文章，如下左樹選單程式，點選 資料夾圖示 img 會展開與合併左樹選單，
而點選如下程式中的 span 標籤內的文字，來觸發反應。
<pre>
&#x3C;ul&#x3E;
    &#x3C;li id=&#x27; [子項目1 id] &#x27; class=&#x27;list-group-item&#x27;&#x3E;
        &#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-open.png&#x27; alt=&#x27;profile Pic&#x27;&#x3E;
        &#x3C;span id=&#x27;folder_span&#x27;&#x3E;[ 子項目1名稱  ] &#x3C;&#x2F;span&#x3E;
    &#x3C;&#x2F;li&#x3E;
    &#x3C;li id=&#x27; [子項目2 id] &#x27; class=&#x27;list-group-item&#x27;&#x3E;
        &#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-open.png&#x27; alt=&#x27;profile Pic&#x27;&#x3E;
        &#x3C;span id=&#x27;folder_span&#x27;&#x3E;[ 子項目2名稱  ] &#x3C;&#x2F;span&#x3E;
    &#x3C;&#x2F;li&#x3E;
...
&#x3C;&#x2F;ul&#x3E;
</pre>

<p>如下為 右內容頁面的程式，對!就那麼簡單，因為後續內容一樣使用 controller 串出。</p>
<pre>
  &#x3C;div class=&#x22;col-8&#x22;&#x3E;  
    &#x3C;h2&#x3E;作品分類:&#x3C;span id=&#x27;RightContentTitle&#x27;&#x3E;&#x3C;&#x2F;span&#x3E;&#x3C;&#x2F;h2&#x3E;    
    &#x3C;div id=&#x22;RightContent&#x22; class=&#x22;card-deck&#x22; style=&#x22;margin-top:20px&#x22; &#x3E;&#x3C;&#x2F;div&#x3E;
  &#x3C;&#x2F;div&#x3E;
</pre>

<hr>
<h4>點選span文字後變粗體字，並右內容頁面title顯示分類名稱</h4>
與前一篇文章觸發 資料夾圖示一樣， $( ).on("click" , "xxx" , function(){... } ); 
的觸發方法需要在文件被瀏覽器解析時 $(document).ready(function(){ }); 方法裡執行。
span被點選後，使用 changeTreeWordingWeightBolder () 方法讓字體變粗。

<p>這邊changeTreeWordingWeightBolder() 函式中改變字體的粗細會使用 removeClass() 與 addClass() 兩個對應的jQuery方法，<br>此系統先定義被點選後粗體字使用此三個效果: font-weight-bolder 、text-info 、h5 ，如下:</p>
<ul>
    <li>font-weight-bolder : 字體變粗</li>
    <li>text-info : boostrap 字體效果，呈現水藍色</li>
    <li>h5 :  標題，可讓字體變大</li>
</ul>


<p>因此該函式將字體變粗的邏輯就很簡單，當有 span 文字被點選時，<br>使用 removeClass() 移除該左樹選單所有被變粗字體的效果，然後使用 addClass() 將該被點選的span文字變為粗體字。</p>
<pre>
$(document).ready(function(){
  $("#LeftTreeMenu").on("click", "span" ,function(){
    if($(this).attr('id')=='folder_span'){      
        changeTreeWordingWeightBolder($(this));
    ...
  });
});

function changeTreeWordingWeightBolder(clickSpan){   
  $("#LeftTreeMenu").find("span").removeClass("font-weight-bolder text-info h5");
  clickSpan.addClass("font-weight-bolder text-info h5");
}
</pre>

<p>依照右邊內容頁面的程式，如下:</p>
<pre>
  &#x3C;div class=&#x22;col-8&#x22;&#x3E;  
    &#x3C;h2&#x3E;作品分類:&#x3C;span id=&#x27;RightContentTitle&#x27;&#x3E;&#x3C;&#x2F;span&#x3E;&#x3C;&#x2F;h2&#x3E;    
    &#x3C;div id=&#x22;RightContent&#x22; class=&#x22;card-deck&#x22; style=&#x22;margin-top:20px&#x22; &#x3E;&#x3C;&#x2F;div&#x3E;
  &#x3C;&#x2F;div&#x3E;
</pre>

<p>若點選該 span 的分類名稱文字後，使用 .text() 將該名稱文字顯示在 id 為 RightContentTitle 的右內容頁面的 span 標題上，如下程式:</p>
<pre>
$("#LeftTreeMenu").on("click", "span" ,function(){
      ......    
    $("#RightContentTitle").text($(this).text());
      ......   
</pre>

<hr>
<h4>ajax 導向 controller 串出右內容頁字卡效果</h4>
如下圖為右內容頁字卡效果:
![](/images/pasted-27.png)


<p>一樣承前面小節中所提的右內容頁，與串出左選單樹邏輯類似，將之後串出的右內容頁字卡 html 以 jquery 的 .html()的方法產生於 id為 RightContent 的 div 內部。 </p>
<pre>
  &#x3C;div class=&#x22;col-8&#x22;&#x3E;  
    &#x3C;h2&#x3E;作品分類:&#x3C;span id=&#x27;RightContentTitle&#x27;&#x3E;&#x3C;&#x2F;span&#x3E;&#x3C;&#x2F;h2&#x3E;    
    &#x3C;div id=&#x22;RightContent&#x22; class=&#x22;card-deck&#x22; style=&#x22;margin-top:20px&#x22; &#x3E;&#x3C;&#x2F;div&#x3E;
  &#x3C;&#x2F;div&#x3E;
</pre>

<p>承上一樣的操作邏輯，點選 span 後使用 ajax 網址導向到 routes / web.php ，如下程式:</p>
<pre>
$(document).ready(function(){
    ......
  $(&#x22;&#x23;LeftTreeMenu&#x22;).on(&#x22;click&#x22;, &#x22;span&#x22; ,function(){
    if($(this).attr(&#x27;id&#x27;)==&#x27;folder_span&#x27;){   
        ......
      buildRightContentCard(ThisNodeCategoryId);
    }
  });
});

function buildRightContentCard(ThisNodeCategoryId){
  $.ajax({
    type:&#x27;GET&#x27;,
    url:&#x27;&#x2F;portfolioRightContentBuild&#x27;,
    data: {ThisNodeCategoryId:ThisNodeCategoryId,
       &#x22;_token&#x22;: &#x22; csrf_token() &#x22;} ,&#x2F;&#x2F;412
    success:function(result){    
      $(&#x22;&#x23;RightContent&#x22;).html(result);      
    } 
  });
}
</pre>

<p>routes / web.php 導向的寫法:</p>
<pre>
//點選左樹選單後，產生右內容頁
Route::get('/portfolioRightContentBuild','portfolioController@buildRightContent');
</pre>

<hr>
<h4>controller 串出右內容字卡內容</h4>
路由 routes / web.php 導向 controller ，需要先從之前新增的作品表 portfolio 撈取資料。新增作品表<的 Model 後，使用 ->where() 方法依照分類 id 找出所有的作品項目，程式如下:
<pre>
&#x3C;?php
namespace App;
use Illuminate&#x5C;Database&#x5C;Eloquent&#x5C;Model;
use Illuminate&#x5C;Support&#x5C;Facades&#x5C;DB;

<p>class portfolio extends Model<br>{<br>    protected $table = &#x27;portfolio&#x27;;<br>    function findportfolioInfoByCategoryId(int $categoryId){<br>        return DB::table(&#x27;portfolio&#x27;)<br>        -&#x3E;where(&#x27;portfolio_category_id&#x27;,&#x27;=&#x27;, $categoryId )<br>        -&#x3E;where(&#x27;is_delete&#x27;,&#x27;=&#x27;,0)<br>        -&#x3E;get();<br>    }<br>}<br></pre></p>
<p>路由導向到 controller 後，進入 buildRightContent()方法，使用 portfolio() 資料模型，並用上面於Model建立的 findportfolioInfoByCategoryId() 方法，並將取出的作品資料存入 $portfolioInfoFromDB 變數。</p>
<p>使用 foreach() 迴圈逐筆將$portfolioInfoFromDB參數中的作品資料取出，並串組成右內容頁的作品字卡。使用 $cardNumInRow = 2 該字卡樣板是否每列 row 兩個字卡，超過就是用 div 換行，如下程式:</p>
<pre>
use App&#x5C;portfolio;
class portfolioController extends Controller{
        ......
    function buildRightContent(Request $request){
        $db = new portfolio();
        $portfolioInfoFromDB = $db -&#x3E; findportfolioInfoByCategoryId($request-&#x3E;ThisNodeCategoryId);
        $RightContentHtml = &#x22;&#x22;;

        $cardCount = 1;
        $cardNumInRow = 2;
        foreach($portfolioInfoFromDB as $portfolio){
            if($cardCount%$cardNumInRow==1  ) $RightContentHtml = $RightContentHtml.&#x22;&#x3C;div class=&#x27;row col-12&#x27; style=&#x27;margin-top:20px&#x27;&#x3E;&#x22;;
            $RightContentHtml = $RightContentHtml
            .&#x22;&#x3C;div class=&#x27;card col-md-12 col-12&#x27;&#x3E;&#x22;
                .&#x22;&#x3C;div class=&#x27;card-body&#x27;&#x3E;&#x22;
                    .&#x22;&#x3C;h5 class=&#x27;card-title&#x27;&#x3E;&#x22;
                        .&#x22;&#x3C;img id=&#x27;skill_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;skill.png&#x27; alt=&#x27;profile Pic&#x27;&#x3E;&#x22;
                        .$portfolio-&#x3E;name
                    .&#x22;&#x3C;&#x2F;h5&#x3E;&#x22;            
                    .&#x22;&#x3C;p class=&#x27;card-text&#x27;&#x3E;&#x22;.$portfolio-&#x3E;discription .&#x22;&#x3C;&#x2F;p&#x3E;&#x22;
                    .&#x22;&#x3C;input type=&#x27;submit&#x27; value=&#x27;編輯&#x27; class=&#x27;btn btn-info&#x27; data-toggle=&#x27;modal&#x27; data-target=&#x27;&#x23;editWorkingAbilityModal_&#x22;.$portfolio-&#x3E;id.&#x22;&#x27; &#x3E;&#x22;
                    .&#x22;&#x3C;input type=&#x27;button&#x27; value=&#x27;刪除&#x27; class=&#x27;btn btn-danger&#x27; onclick=&#x27;deleteWorkingAbilityAndReloadRightContentCard(&#x22;.$portfolio-&#x3E;id.&#x22;)&#x27; &#x3E;&#x22;
                .&#x22;&#x3C;&#x2F;div&#x3E;&#x22;
            .&#x22;&#x3C;&#x2F;div&#x3E;&#x22;;
            if($cardCount%$cardNumInRow==0  ) $RightContentHtml = $RightContentHtml.&#x22;&#x3C;&#x2F;div&#x3E;&#x22;;            
            $cardCount ++;
        }        
        return $RightContentHtml;
    }
</pre>


<p>回到 view 的 ajax() 中，將串出的html回傳使用 .html() 的 jquery方法，在 id 為 RightContent 的 div 中組出右內容頁的作品縮圖，程式如下:</p>
<pre>
function buildRightContentCard(ThisNodeCategoryId){  
  $.ajax({
    type:&#x27;GET&#x27;,
    url:&#x27;&#x2F;portfolioRightContentBuild&#x27;,
    data: {ThisNodeCategoryId:ThisNodeCategoryId,
       &#x22;_token&#x22;: &#x22; csrf_token() &#x22;} ,&#x2F;&#x2F;412
    success:function(result){    
      $(&#x22;&#x23;RightContent&#x22;).html(result);      
    },
    error:function(){
      console.log(&#x22;buildRightContentCard error &#x22;);
    }
  });
}

        ......

  &#x3C;div class=&#x22;col-8&#x22;&#x3E;  
    &#x3C;h2&#x3E;作品分類:&#x3C;span id=&#x27;RightContentTitle&#x27;&#x3E;&#x3C;&#x2F;span&#x3E;&#x3C;&#x2F;h2&#x3E;    
    &#x3C;div id=&#x22;RightContent&#x22; class=&#x22;card-deck&#x22; style=&#x22;margin-top:20px&#x22; &#x3E;&#x3C;&#x2F;div&#x3E;
  &#x3C;&#x2F;div&#x3E;
</pre>

<hr>
<h4>呈現結果</h4>
完成後，點選左樹選單的項目後，右內容頁的標題會顯示分類名稱，並且顯示作品縮圖。

<img src="https://i.imgur.com/HmgMO77.gif" />
      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/08/01/laravel-%E4%BD%9C%E5%93%81%E9%9B%867-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE4-%E6%8C%89%E4%B8%8B%E9%81%B8%E5%96%AE%E5%BE%8C%E5%B0%8D%E6%87%89%E5%8F%B3%E5%85%A7%E5%AE%B9%E9%A0%81/" data-id="cke9vbrc7000rggx1fwbh1i7w" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-laravel-作品集6-撰寫左樹選單3-產生下一層節點，並使用jquery設計樹選單開闔" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/31/laravel-%E4%BD%9C%E5%93%81%E9%9B%866-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE3-%E7%94%A2%E7%94%9F%E4%B8%8B%E4%B8%80%E5%B1%A4%E7%AF%80%E9%BB%9E%EF%BC%8C%E4%B8%A6%E4%BD%BF%E7%94%A8jquery%E8%A8%AD%E8%A8%88%E6%A8%B9%E9%81%B8%E5%96%AE%E9%96%8B%E9%97%94/" class="article-date">
  <time datetime="2020-07-31T11:15:00.000Z" itemprop="datePublished">2020-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/31/laravel-%E4%BD%9C%E5%93%81%E9%9B%866-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE3-%E7%94%A2%E7%94%9F%E4%B8%8B%E4%B8%80%E5%B1%A4%E7%AF%80%E9%BB%9E%EF%BC%8C%E4%B8%A6%E4%BD%BF%E7%94%A8jquery%E8%A8%AD%E8%A8%88%E6%A8%B9%E9%81%B8%E5%96%AE%E9%96%8B%E9%97%94/">[laravel][作品集6] 撰寫左樹選單3-產生下一層節點，並使用jquery設計樹選單開闔</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>規劃設計一個能有左選單樹進行分類的作品集介面，如下圖:<br><img src="/images/pasted-1.png" alt="圖:預計畫面"></p>
<hr>
<h4>Jquery 實現左樹選單操作邏輯</h4>
在前文中提到，該左樹選單在網頁初始時只會產生第一層節點，點選其中一個節點的icon(資料夾圖示) 後才會產生該節點的下一層子節點
(點選該節點的文字是不會有反應的喔 ) 。產生子節點後，其每個子節點都承襲一樣的邏輯可點選icon再產生子節點。

<p>父節點在產生子節點後，就不需要再次產生一次子節點，要不失去節省效能的意義，因此這部分也需要加上程式判斷，<br>並且在已經產生子節點後，該父節點就需要另外做展開與收合的判斷。</p>
<p>雖然初學者撰寫一些工能都是邊開發邊整理邏輯，但能的話我還是會練習在開發前盡量去梳理出大致的程式邏輯，呈上整理出邏輯如下:</p>
<ul>
<li>點選左樹選單的 icon圖示<ul>
<li>if 判斷該圖示的所屬節點 ( li 項目) 其還未產生子節點<ul>
<li>若該父節點還未產生子節點，則執行 ajax()產生</li>
</ul>
</li>
<li>else if 若該父節點已經產生子節點，另外判斷是否開闔 ( 隱藏或顯示 )<ul>
<li>if 該父親節點是打開的( 其下的多個子節點是顯示的)<ul>
<li>將其下多個子節點隱藏</li>
</ul>
</li>
<li>else if 該父親節點是收合的( 其下的多個子節點是隱藏的)<ul>
<li>將其下多個子節點顯示</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>整理出大致的程式邏輯與流程後，便開始以 jquery 撰寫。</p>
<hr>
<h4>點選 icon後產生其子節點</h4>
範例程式:
<pre>
&#x3C;ul&#x3E;
    &#x3C;li id=&#x27; [父節點 id] &#x27; class=&#x27;list-group-item&#x27;&#x3E;
        &#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-open.png&#x27;&#x3E;
        &#x3C;span id=&#x27;folder_span&#x27;&#x3E;[ 父節點名稱  ] &#x3C;&#x2F;span&#x3E;
    &#x3C;&#x2F;li&#x3E;
    &#x3C;ul&#x3E;
        &#x3C;li id=&#x27; [子節點-1 id] &#x27; class=&#x27;list-group-item&#x27;&#x3E;
            &#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-open.png&#x27;&#x3E;
            &#x3C;span id=&#x27;folder_span&#x27;&#x3E;[ 子節點-1 名稱  ] &#x3C;&#x2F;span&#x3E;
        &#x3C;&#x2F;li&#x3E;
                ......
    &#x3C;&#x2F;ul&#x3E;
   ......
&#x3C;&#x2F;ul&#x3E;
</pre>

<p>點選該左樹選單內的 icon 圖示，本文使用的是 .on()的方法，去判斷 樹選單內的元素是否被點選:</p>
<pre>
$("#LeftTreeMenu" ).on ( "click" , "img" , function() { ...點選後執行動作... } );
</pre>

<p>點選 icon 圖示( 標籤img )後，先判斷該被點選的節點 (父節點) 是否其下有其他項目，<br>也就是該父節點的 li 後面是否有接新的 ul ，如上的範例程式。<br>被點選的該圖示( img標籤 ) 在函式中以 $( this ) 表示，使用 .parent() 方法只往上層(外層)找一層去找尋是否符合的 li 標籤，<br>找到對應的 li 就是父節點，再以父節點為準再往下一層 .next() 找是否符合的 ul 元素，程式如下:</p>
<pre>
if($(this).parent("li").next("ul").length == 0){
    // 若該父節點還未產生子節點，則執行 ajax()產生
}else {
    // 若該父節點已經產生子節點，另外判斷是否開闔 ( 隱藏或顯示 )
}
</pre>

<p>判斷確定父節點還未產生節點後，要先取得該父節點的 id ，這樣才能依照該 id 執行上一章節中撰寫的 ajax()程式產生下一層的子節點。<br>一樣使用 $( this ) 指向該 img ，這次換 .closest() 方法，此方法會不斷向上找符合條件的才會停止，也就是要找到 li 元素並取的 id。<br>隨後找到 父節點 li 後，便用 .attr( ‘id’ ) 取得 id ，程式如下:</p>
<pre>
var ThisNodeCategoryId = $(this).closest("li").attr("id");
</pre>
<p>再來切換 icon圖片，一樣使用 .attr() 方法更換該圖示 img 的 src 路徑 ， .attr( ‘修改元素’  ,  ‘修改該元素值’ )</p>
<pre>
$(this).attr('src','/icon/folder-open.png');
</pre>

<p>因為圖片本身沒設定onclick 方法，所以這個 .on( “clcik” … ) 的事件需要再 文件的 DOM 被瀏覽器解析好後執行，需將該 .on() 的觸發判斷寫在 $( document ).ready() 事件中，因此最終完成程式如下:</p>
<pre>
$(document).ready(function(){
    ......
  $("#LeftTreeMenu").on("click", "img" ,function(){
    if($(this).attr('id')=='folder_icon'){      
      if($(this).parent("li").next("ul").length == 0){
        $(this).attr('src','/icon/folder-open.png');
        var ThisNodeCategoryId = $(this).closest("li").attr("id");
        buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId);
      }else{   
        // 若該父節點已經產生子節點，另外判斷是否開闔 ( 隱藏或顯示 )
      }
    }  
  });
});
</pre>

<hr>
<h4> ajax() 將產生的子節點加入父節點之後</h4>
由上一章所撰寫的 controller 串出的下一層子節點一樣回傳到 ajax() 的 success:function( result ) 的 result 參數中。不過跟上一章節使用的 .append() 是不同的方法 ，是使用 .after() 。
<pre>
function buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId){
    $.ajax({
       ......
      success:function(result){
        if(ThisNodeCategoryId==0){ // 一開始網頁初始
          $("#LeftTreeMenu").append(result);
        }else{// 產生該父節點下一層子節點
          $("#"+ThisNodeCategoryId).after(result);   
        }
      },error:function(){　......　}
    });
}
</pre>
兩這方法的差異處在於 .append() 是將 html 組成在該元素的 div 內，但 after() 是串在該標籤的下一個標籤位置。
參閱文章一開始的範例程式，也就是父節點 li 的下一個位置產生 ul ，此就為 .after() 的功能。

<hr>
<h4>產生左樹選單節點開合功能</h4>
最後，若該父節點已經產生其下一層的子節點，那剩下需要處理的邏輯就是將該父節點下一層 ul 標籤隱藏或顯示。
一樣是將該功能另外分隔出另外一個函式: changeTreeChildNodesShowAndHiden($(this)) ，
將該圖示 img 傳遞給此函示，並命名為 clickImg ，最後續處裡。<br><br>


<p>同樣參考本文章一開始的範例程式，一樣的尋找邏輯，該圖示 img 被點選後，先用 .parent() 去尋找其所屬的父節點，然後再用 .next() 找父節點下一個的 子節點 ul 標籤。跟前文一開始判斷該父節點是否產生子節點一樣的語法。<br>只是再加上  .is( ‘:hidden’ ) 或 .is( ‘:visible’ ) 判斷是否開啟或關閉，若該子節點 ul 標籤是隱藏的  .is( ‘:hidden’ ) ，並顯示子節點 .show(“slow”) 並用 attr() 切換圖片。<br>反之子節點 ul 標籤是顯示的  .is( ‘:visible’ ) ，就隱藏子節點 .hide(“slow”) 然後同樣用 attr() 切換圖片，完整程式如下:</p>
<pre>
$(document).ready(function(){  ......
  $("#LeftTreeMenu").on("click", "img" ,function(){
    ......
    if($(this).parent("li").next("ul").length == 0){
        // 若該父節點還未產生子節點，則執行 ajax()產生
    }else {
        // 若該父節點已經產生子節點，另外判斷是否開闔 ( 隱藏或顯示 )
        changeTreeChildNodesShowAndHiden($(this));
    }
    ......
  });
});

function changeTreeChildNodesShowAndHiden(clickImg){
    if(clickImg.parent("li").next('ul').is(':hidden')){      
      clickImg.parent("li").next('ul').show("slow");
      clickImg.attr('src','/icon/folder-open.png');
    }else if(clickImg.parent("li").next('ul').is(':visible')){         
      clickImg.parent("li").next('ul').hide("slow");
      clickImg.attr('src','/icon/folder-close.png');
    }
}
</pre>


<hr>
<h4>呈現結果</h4>
呈現效果如下:
<img  src="https://imgur.com/IbL3mJf.gif" />

<p>完成程式如下:</p>
<pre>
@extends(&#x27;layout.master.baseMaster&#x27;)

@section(&#x27;content&#x27;)
&#x3C;script&#x3E;
$(document).ready(function(){
  buildNextLevelByThisNodeIdForTreeMenu(0);

  $(&#x22;&#x23;LeftTreeMenu&#x22;).on(&#x22;click&#x22;, &#x22;img&#x22; ,function(){
    if($(this).attr(&#x27;id&#x27;)==&#x27;folder_icon&#x27;){      
      if($(this).parent(&#x22;li&#x22;).next(&#x22;ul&#x22;).length == 0){
        $(this).attr(&#x27;src&#x27;,&#x27;&#x2F;icon&#x2F;folder-open.png&#x27;);
        var ThisNodeCategoryId = $(this).closest(&#x22;li&#x22;).attr(&#x22;id&#x22;);
        buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId);
      }else{   
        changeTreeChildNodesShowAndHiden($(this));
      }
    }  
  });
});
function buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId){
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioTreeMenuThisNodeBuildNextLevel&#x27;,
      data: {ThisNodeCategoryId:ThisNodeCategoryId,
         &#x22;_token&#x22;: &#x22; csrf_token() &#x22;} ,&#x2F;&#x2F;412
      success:function(result){
        if(ThisNodeCategoryId==0){&#x2F;&#x2F; first level of Tree view
          $(&#x22;&#x23;LeftTreeMenu&#x22;).append(result);
        }else{
          $(&#x22;&#x23;&#x22;+ThisNodeCategoryId).after(result);   
        }
      },
      error:function(){
        console.log(&#x22;buildNextLevelByThisNodeIdForTreeMenu error &#x22;);
      }
    });
}

function changeTreeChildNodesShowAndHiden(clickImg){
    if(clickImg.parent(&#x22;li&#x22;).next(&#x27;ul&#x27;).is(&#x27;:hidden&#x27;)){      
      clickImg.parent(&#x22;li&#x22;).next(&#x27;ul&#x27;).show(&#x22;slow&#x22;);
      clickImg.attr(&#x27;src&#x27;,&#x27;&#x2F;icon&#x2F;folder-open.png&#x27;);
    }else if(clickImg.parent(&#x22;li&#x22;).next(&#x27;ul&#x27;).is(&#x27;:visible&#x27;)){            
      clickImg.parent(&#x22;li&#x22;).next(&#x27;ul&#x27;).hide(&#x22;slow&#x22;);
      clickImg.attr(&#x27;src&#x27;,&#x27;&#x2F;icon&#x2F;folder-close.png&#x27;);
    }
}
&#x3C;&#x2F;script&#x3E;

&#x3C;div id=&#x22;LeftTreeMenu&#x22; class=&#x22;col-4 list-group list-group-flush&#x22; style=&#x22;margin-top:20px&#x22;&#x3E;
@endsection(&#x27;content&#x27;)
</pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/07/31/laravel-%E4%BD%9C%E5%93%81%E9%9B%866-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE3-%E7%94%A2%E7%94%9F%E4%B8%8B%E4%B8%80%E5%B1%A4%E7%AF%80%E9%BB%9E%EF%BC%8C%E4%B8%A6%E4%BD%BF%E7%94%A8jquery%E8%A8%AD%E8%A8%88%E6%A8%B9%E9%81%B8%E5%96%AE%E9%96%8B%E9%97%94/" data-id="cke9vbrc3000mggx1etirfsa9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-laravel-作品集5-撰寫左樹選單2-初始頁面從資料庫撈取第一層" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/31/laravel-%E4%BD%9C%E5%93%81%E9%9B%865-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE2-%E5%88%9D%E5%A7%8B%E9%A0%81%E9%9D%A2%E5%BE%9E%E8%B3%87%E6%96%99%E5%BA%AB%E6%92%88%E5%8F%96%E7%AC%AC%E4%B8%80%E5%B1%A4/" class="article-date">
  <time datetime="2020-07-31T07:13:00.000Z" itemprop="datePublished">2020-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/31/laravel-%E4%BD%9C%E5%93%81%E9%9B%865-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE2-%E5%88%9D%E5%A7%8B%E9%A0%81%E9%9D%A2%E5%BE%9E%E8%B3%87%E6%96%99%E5%BA%AB%E6%92%88%E5%8F%96%E7%AC%AC%E4%B8%80%E5%B1%A4/">[laravel][作品集5] 撰寫左樹選單2-初始頁面從資料庫撈取第一層</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>規劃設計一個能有左選單樹進行分類的作品集介面，如下圖:<br><img src="/images/pasted-1.png" alt="圖:預計畫面"></p>
<hr>
<h4>產生左選單邏輯</h4>

<p>規劃左樹狀選單在一開始產生時只撈取第一層節點，在滑鼠點擊第一層的節點後，才會產生下一層。<br>此設計一來程式相對單純些，並且若節點數量太多時也比較省效能。</p>
<p>呈上邏輯，在初始該作品集的頁面時，使用 ajax() 呼叫controller 撈取資料庫第一層(或下一層)的多個節點資料，<br>然後在 controller 串好 html碼後 response 給 view 以jquery 產生整個 左樹選單。</p>
<hr>
<h4>ajax() 藉由路由導向呼叫 Controller </h4>
先設定 div 標籤 id = LeftTreeMenu，為後續產生樹選單後，使用 jquery append() 產生於該div內。
<pre>
&#x3C;div id=&#x22;LeftTreeMenu&#x22; class=&#x22;list-group list-group-flush&#x22; style=&#x22;margin-top:20px&#x22;&#x3E;
</pre>


<p>接下來轉寫 ajax()，由於該 ajax() 主要行為是左樹選單 “從該層節點中產生下一層的所有節點”，因此除了一開始開啟網頁會使用到此 ajax()，在滑鼠點擊時也會使用到此 ajax()。所以將該 ajax()的功能包成個函式方便後續 reuse 。</p>
<p>使用 $(document).ready( function(){…} ) ，就是代表頁面 document 被瀏覽器解析後便直接執行該 ajax()的 函式</p>
<pre>
$(document).ready(function(){
    buildNextLevelByThisNodeIdForTreeMenu(0);
});
</pre>


<p>在view: portfolioIndex.blade.php 頁面完成程式如下:</p>
<pre>
@section(&#x27;content&#x27;)
&#x3C;script&#x3E;
$(document).ready(function(){
    buildNextLevelByThisNodeIdForTreeMenu(0);
});
function buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId){
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioTreeMenuThisNodeBuildNextLevel&#x27;,
      data: {ThisNodeCategoryId:ThisNodeCategoryId,
         &#x22;_token&#x22;: &#x22; csrf_token() &#x22;} ,&#x2F;&#x2F;412
      success:function(result){
        $(&#x22;&#x23;LeftTreeMenu&#x22;).append(result);
      },
      error:function(){
        console.log(&#x22;buildNextLevelByThisNodeIdForTreeMenu error &#x22;);
      }
    });
}
&#x3C;&#x2F;script&#x3E;

&#x3C;div id=&#x22;LeftTreeMenu&#x22; class=&#x22;list-group list-group-flush&#x22; style=&#x22;margin-top:20px&#x22;&#x3E;
@endsection(&#x27;content&#x27;)
</pre>

<p>ajax() 的 http get 請求，會以routes / web.php 的路由程式去進行下一步導向，<br>導向至 portfolioController.php 的 controller 程式中的  buildNextLevelByThisNodeCategoryForTreeMenu() 方法中。</p>
<pre>
//初始左樹選單，或滑鼠點擊產生下一層
Route::get('/portfolioTreeMenuThisNodeBuildNextLevel','portfolioController@buildNextLevelByThisNodeCategoryForTreeMenu');
</pre>


<hr>
<h4>Controller 串出該節點下一層的左樹選單</h4>

<p>當路由將ajax() 的 get 請求導向到 controller 的程式中時，就要依照 request 提供的該節點項目id(父節點 id)找出其子節點，並組成如下的 ul/li 項目:</p>
<pre>
&#x3C;ul&#x3E;
    &#x3C;li id=&#x27; [子項目1 id] &#x27; class=&#x27;list-group-item&#x27;&#x3E;
        &#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-open.png&#x27; alt=&#x27;profile Pic&#x27;&#x3E;
        &#x3C;span id=&#x27;folder_span&#x27;&#x3E;[ 子項目1名稱  ] &#x3C;&#x2F;span&#x3E;
    &#x3C;&#x2F;li&#x3E;
    &#x3C;li id=&#x27; [子項目2 id] &#x27; class=&#x27;list-group-item&#x27;&#x3E;
        &#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-open.png&#x27; alt=&#x27;profile Pic&#x27;&#x3E;
        &#x3C;span id=&#x27;folder_span&#x27;&#x3E;[ 子項目2名稱  ] &#x3C;&#x2F;span&#x3E;
    &#x3C;&#x2F;li&#x3E;
...
&#x3C;&#x2F;ul&#x3E;
</pre>

<p>因後續 controller 會需要依照 父節點 id找出其子節點的所有資料，因此在 app / portfolioCategory.php 的 Model 中另外撰寫一隻取資料庫的方法:findAllChildNodesByParentId()，<br>語法很簡單，用 -&gt;where() 找所有parentId 為該節點的所有子節點，如下:</p>
<pre>
public function findAllChildNodesByParentId(int $parentId){
    return DB::table('portfolio_category')
     ->where('parent_id','=', $parentId )
     ->where('is_delete','=',0)
     ->get();
}
</pre>

<p>因後續 controller 會需要依照 父節點 id找出其子節點的所有資料，因此在 app / portfolioCategory.php 的 Model 中另外撰寫一隻取資料庫的方法:findAllChildNodesByParentId()，</p>
<pre>
use App\portfolioCategory;
    ......
$db = new portfolioCategory();
$portfolioCategoriesFromDB = $db->findAllChildNodesByParentId($categoryParentId);
</pre>

<p>使用撈取出來的子節點資料(節點id 與 節點名稱)使用 foreach迴圈逐筆串出 ul/li 的架構:</p>
<pre>
$TreeMenuHtml = $TreeMenuHtml.&#x22;&#x3C;ul&#x3E;&#x22;;
foreach($portfolioCategoriesFromDB as $portfolioCategory){
    $TreeMenuHtml = $TreeMenuHtml
        .&#x22;&#x3C;li id=&#x27;&#x22;.$portfolioCategory-&#x3E;id .&#x22;&#x27; class=&#x27;list-group-item&#x27;&#x3E;&#x22;
        .&#x22;&#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-close.png&#x27; alt=&#x27;profile Pic&#x27;&#x3E;  &#x22;
        .&#x22;&#x3C;span id=&#x27;folder_span&#x27; &#x3E;&#x22;.$portfolioCategory-&#x3E;name .&#x22;&#x3C;&#x2F;span&#x3E;&#x22;
        .&#x22;&#x3C;&#x2F;li&#x3E;&#x22;;
}
$TreeMenuHtml = $TreeMenuHtml.&#x22;&#x3C;&#x2F;ul&#x3E;&#x22;;
</pre>

<p>完成程式如下:</p>
<pre>
&#x3C;?php
namespace App&#x5C;Http&#x5C;Controllers;

use Illuminate&#x5C;Http&#x5C;Request;
use App&#x5C;portfolioCategory;

class portfolioController extends Controller
{
    public function buildNextLevelByThisNodeCategoryForTreeMenu(Request $request){
        $categoryParentId = $request-&#x3E;ThisNodeCategoryId;
        $TreeMenuHtml = &#x22;&#x22;;             
        $TreeMenuHtml = $this-&#x3E;buildHtmlEachChildNodesFromDB_ByParentId($TreeMenuHtml,$categoryParentId);        
        return $TreeMenuHtml;
    }

    function buildHtmlEachChildNodesFromDB_ByParentId($TreeMenuHtml,int $categoryParentId){        
        $db = new portfolioCategory();
        $portfolioCategoriesFromDB = $db-&#x3E;findAllChildNodesByParentId($categoryParentId);

        if($portfolioCategoriesFromDB-&#x3E;count()&#x3E;0){            
            $TreeMenuHtml = $TreeMenuHtml.&#x22;&#x3C;ul&#x3E;&#x22;;
            foreach($portfolioCategoriesFromDB as $portfolioCategory){
                $TreeMenuHtml = $TreeMenuHtml
                .&#x22;&#x3C;li id=&#x27;&#x22;.$portfolioCategory-&#x3E;id .&#x22;&#x27; class=&#x27;list-group-item&#x27;&#x3E;&#x22;
                    .&#x22;&#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-close.png&#x27; alt=&#x27;profile Pic&#x27;&#x3E;  &#x22;
                    .&#x22;&#x3C;span id=&#x27;folder_span&#x27; &#x3E;&#x22;.$portfolioCategory-&#x3E;name .&#x22;&#x3C;&#x2F;span&#x3E;&#x22;
                .&#x22;&#x3C;&#x2F;li&#x3E;&#x22;;
            }
            $TreeMenuHtml = $TreeMenuHtml.&#x22;&#x3C;&#x2F;ul&#x3E;&#x22;;
        }        
        return $TreeMenuHtml;
    }
}
</pre>

<hr>
<h4>自最外層串出總目錄的 ul</h4>
在前一篇文章中，設計的樣式最外層有一層 "總目錄" ul 標籤，我習慣是將另外撰寫方法處理。<br>
將功能切開我個人看起來比較清爽，哈哈。
<pre>
public function buildNextLevelByThisNodeCategoryForTreeMenu(Request $request){
    $categoryParentId = $request-&#x3E;ThisNodeCategoryId;
    $TreeMenuHtml = &#x22;&#x22;;   
    $TreeMenuHtml = $this-&#x3E;checkIsInitTreeMenuAndBuildRootHtmlInStart($TreeMenuHtml,$categoryParentId);           
    $TreeMenuHtml = $this-&#x3E;buildHtmlEachChildNodesFromDB_ByParentId($TreeMenuHtml,$categoryParentId);        
    $TreeMenuHtml = $this-&#x3E;checkIsInitTreeMenuAndBuildRootHtmlInEnd($TreeMenuHtml,$categoryParentId);   
    return $TreeMenuHtml;
}

<p>function checkIsInitTreeMenuAndBuildRootHtmlInStart($TreeMenuHtml,int $categoryParentId){<br>    $isInitTreeNode = 0;<br>    if($categoryParentId == $isInitTreeNode){<br>        $TreeMenuHtml = $TreeMenuHtml<br>            .&#x22;&#x3C;ul&#x3E;&#x22;<br>                .&#x22;&#x3C;li id=&#x27;0&#x27; class=&#x27;list-group-item&#x27;&#x3E;&#x22;<br>                    .&#x22;&#x3C;img id=&#x27;folder_icon&#x27; class=&#x27;rounded&#x27; src=&#x27;&#x2F;icon&#x2F;folder-open.png&#x27; alt=&#x27;profile Pic&#x27;&#x3E;&#x22;<br>                    .&#x22;&#x3C;span id=&#x27;folder_span&#x27;&#x3E;總目錄&#x3C;&#x2F;span&#x3E;&#x22;<br>                .&#x22;&#x3C;&#x2F;li&#x3E;&#x22;;<br>    }<br>    return $TreeMenuHtml;<br>}</p>
<p>function checkIsInitTreeMenuAndBuildRootHtmlInEnd($TreeMenuHtml,int $categoryParentId){<br>    $isInitTreeNode = 0;<br>    if($categoryParentId == $isInitTreeNode){<br>        $TreeMenuHtml = $TreeMenuHtml.&#x22;&#x3C;&#x2F;ul&#x3E;&#x22;;<br>    }<br>    return $TreeMenuHtml;<br>}<br></pre></p>
<hr>
<h4>於 view 頁面，將串好的 html 內容append()到左樹選單div中</h4>
最後在view: portfolioIndex.blade.php 頁面，ajax()請求完controller後會在 success:function(result)的方法中將組好的 html傳給 result參數。並使用 .append() 方法讓串好的html 新增在 LeftTreeMenu 的 div 內。

<pre>
function buildNextLevelByThisNodeIdForTreeMenu(ThisNodeCategoryId){
    $.ajax({
      type:&#x27;GET&#x27;,
      url:&#x27;&#x2F;portfolioTreeMenuThisNodeBuildNextLevel&#x27;,
      data: {ThisNodeCategoryId:ThisNodeCategoryId,
         &#x22;_token&#x22;: &#x22; csrf_token() &#x22;} ,&#x2F;&#x2F;412
      success:function(result){
        $(&#x22;&#x23;LeftTreeMenu&#x22;).append(result);
      },
      error:function(){
        console.log(&#x22;buildNextLevelByThisNodeIdForTreeMenu error &#x22;);
      }
    });
}
&#x3C;&#x2F;script&#x3E;
&#x3C;div id=&#x22;LeftTreeMenu&#x22; class=&#x22;list-group list-group-flush&#x22; style=&#x22;margin-top:20px&#x22;&#x3E;
</pre>


<p>呈現畫面如下圖，先是 partId為0，也就是第一層的選項 :</p>
<p><img src="/images/pasted-25.png" alt=""></p>
<p><img src="/images/pasted-26.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://aloo31124.github.io/2020/07/31/laravel-%E4%BD%9C%E5%93%81%E9%9B%865-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE2-%E5%88%9D%E5%A7%8B%E9%A0%81%E9%9D%A2%E5%BE%9E%E8%B3%87%E6%96%99%E5%BA%AB%E6%92%88%E5%8F%96%E7%AC%AC%E4%B8%80%E5%B1%A4/" data-id="cke9vbrc5000qggx1g3f05pn9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ajax/" rel="tag">ajax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一頁 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分類</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-%E9%9A%A8%E7%AD%86%E8%A8%98/">js 隨筆記</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/laravel-%E5%B1%A5%E6%AD%B7%E4%BD%9C%E5%93%81%E7%B7%B4%E7%BF%92/">laravel 履歷作品練習</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/svn-%E9%9A%A8%E7%AD%86%E8%A8%98/">svn 隨筆記</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C%E7%AD%86%E8%A8%98/">工作筆記</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%B7%A8%E7%A2%BC/">編碼</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/" rel="tag">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eclipse/" rel="tag">Eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ajax/" rel="tag">ajax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ajax/" rel="tag">ajax()</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jsp/" rel="tag">jsp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/migration/" rel="tag">migration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mvc/" rel="tag">mvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svn/" rel="tag">svn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tagbase/" rel="tag">tagbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tld/" rel="tag">tld</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%9B%E8%A1%8C%E7%AC%A6%E8%99%9F/" rel="tag">換行符號</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AA%94%E6%A1%88%E4%B8%8A%E5%82%B3/" rel="tag">檔案上傳</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B7%A8%E7%A2%BC/" rel="tag">編碼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B7%A8%E8%AD%AF/" rel="tag">編譯</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="/tags/DOM/" style="font-size: 10px;">DOM</a> <a href="/tags/Eclipse/" style="font-size: 10px;">Eclipse</a> <a href="/tags/ajax/" style="font-size: 10px;">ajax</a> <a href="/tags/ajax/" style="font-size: 10px;">ajax()</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/jquery/" style="font-size: 16.67px;">jquery</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/jsp/" style="font-size: 10px;">jsp</a> <a href="/tags/laravel/" style="font-size: 20px;">laravel</a> <a href="/tags/migration/" style="font-size: 13.33px;">migration</a> <a href="/tags/mvc/" style="font-size: 10px;">mvc</a> <a href="/tags/php/" style="font-size: 20px;">php</a> <a href="/tags/svn/" style="font-size: 10px;">svn</a> <a href="/tags/tagbase/" style="font-size: 10px;">tagbase</a> <a href="/tags/tld/" style="font-size: 10px;">tld</a> <a href="/tags/%E6%8F%9B%E8%A1%8C%E7%AC%A6%E8%99%9F/" style="font-size: 10px;">換行符號</a> <a href="/tags/%E6%AA%94%E6%A1%88%E4%B8%8A%E5%82%B3/" style="font-size: 10px;">檔案上傳</a> <a href="/tags/%E7%B7%A8%E7%A2%BC/" style="font-size: 13.33px;">編碼</a> <a href="/tags/%E7%B7%A8%E8%AD%AF/" style="font-size: 10px;">編譯</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">彙整</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/25/laravel/">[laravel][作品集12] 右側內容頁面1-新增作品</a>
          </li>
        
          <li>
            <a href="/2020/08/25/laravel-%E4%BD%9C%E5%93%81%E9%9B%8611-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE8-%E5%88%AA%E9%99%A4%E5%88%86%E9%A1%9E/">[laravel][作品集11] 撰寫左樹選單8-刪除分類</a>
          </li>
        
          <li>
            <a href="/2020/08/25/laravel-%E4%BD%9C%E5%93%81%E9%9B%8610-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE7-%E4%BF%AE%E6%94%B9%E5%88%86%E9%A1%9E%E5%90%8D%E7%A8%B1/">[laravel][作品集10] 撰寫左樹選單7-修改分類名稱</a>
          </li>
        
          <li>
            <a href="/2020/08/13/%E4%BD%9C%E5%93%81%E9%9B%869-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE6-%E6%96%B0%E5%A2%9E%E5%88%86%E9%A1%9E%E5%BE%8C%E6%9B%B4%E6%96%B0%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE/">[laravel][作品集9] 撰寫左樹選單6-新增分類後更新左樹選單</a>
          </li>
        
          <li>
            <a href="/2020/08/13/%E4%BD%9C%E5%93%81%E9%9B%868-%E6%92%B0%E5%AF%AB%E5%B7%A6%E6%A8%B9%E9%81%B8%E5%96%AE5-%E7%94%A2%E7%94%9F-%E6%96%B0%E5%A2%9E%E5%88%86%E9%A1%9E-%E8%BC%B8%E5%85%A5%E6%A1%86/">[laravel][作品集8] 撰寫左樹選單5-產生[新增分類]輸入框</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 盧本翔<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>